import{r as R,h as M,Y as O,j as E,k as q,t as N,a as w,b as P,w as o,l as r,n as Y,e as G,p as n,x as k,y,u as F,v as j,q as S,s as u,C as V,ak as te,c as A,F as W,I as oe,D as Z,Z as H,d as I}from"./index.9c437169.js";import{p as z}from"./pick.40b27695.js";import{f as ne,a as ae}from"./goods.1eb4fb89.js";const T={getItems:"/api/user/market/topic/list",getView:"/api/user/market/topic/view",updateItem:"/api/user/market/topic/update",getItemsGoods:"/api/user/market/topic/topic_items",updateGoods:"/api/user/market/topic/update_goods",updateStatus:"/api/user/market/topic/updateStatus"};function le(U){return R({url:T.updateGoods,method:"post",data:U})}function se(U){return R({url:T.updateItem,method:"post",data:U})}const ie={class:"w-32 mt-1 mb-2 mr-2 btn btn-outline-success btn-sm"},re=M({__name:"topic",emits:["ok"],setup(U,{expose:x,emit:$}){const a=O().uploadUrl,c=E({id:0,classes:"",name:"",content:"",pic_url:""}),d={},e=E({visible:!1,confirmLoading:!1}),b=()=>{e.visible=!1},h=t=>{c.pic_url=t.data.item.img},f=q(d,N(c)),v=t=>{e.visible=!0,Object.assign(c,{id:0,classes:"",name:"",content:"",pic_url:""}),j(()=>{Object.assign(c,z(t,["id","name","content","pic_url"]))})},m=()=>{if(e.confirmLoading=!0,f.value.$touch(),f.value.$invalid)f.value.$errors,e.confirmLoading=!1;else{const t=F(c);se(t).then(s=>{const{code:_}=s||{};_===0?S.success("\u4FDD\u5B58\u6210\u529F"):S.error(s.message),e.confirmLoading=!1,$("ok",t),e.visible=!1})}};return x({edit:v}),(t,s)=>{const _=u("h-form-item"),C=u("UploadIcon"),B=u("h-upload"),l=u("h-form"),i=u("LoadingIcon"),p=u("h-modal");return w(),P(p,{title:"\u53D1\u5E03\u4E13\u9898",size:"modal-lg",visible:e.visible,"confirm-loading":e.confirmLoading,onCancel:b},{footer:o(()=>[r("button",{class:"w-24 mb-2 mr-1 btn btn-primary",onClick:s[3]||(s[3]=D=>m())},[Y(" \u4FDD\u5B58 "),e.confirmLoading?(w(),P(i,{key:0,icon:"oval",color:"white",class:"w-4 h-4 ml-2"})):G("",!0)])]),default:o(()=>[n(l,{layout:"small"},{default:o(()=>[n(_,{label:"\u4E13\u9898\u540D\u79F0",content:"",layout:"small"},{default:o(()=>[k(r("input",{type:"text",class:"form-control","onUpdate:modelValue":s[0]||(s[0]=D=>c.name=D)},null,512),[[y,c.name]])]),_:1}),n(_,{label:"\u5185\u5BB9",content:"",layout:"small"},{default:o(()=>[k(r("textarea",{class:"form-control","onUpdate:modelValue":s[1]||(s[1]=D=>c.content=D),rows:4},null,512),[[y,c.content]])]),_:1}),n(_,{label:"\u56FE\u7247",content:"",layout:"small"},{default:o(()=>[k(r("input",{type:"text",class:"form-control","onUpdate:modelValue":s[2]||(s[2]=D=>c.pic_url=D),placeholder:""},null,512),[[y,c.pic_url]]),n(B,{name:"file",multiple:!0,action:F(a),onChange:h},{default:o(()=>[r("button",ie,[n(C,{class:"w-4 h-4 mr-2"}),Y("\u4E0A\u4F20 ")])]),_:1},8,["action"])]),_:1})]),_:1})]),_:1},8,["visible","confirm-loading"])}}}),ue={class:"input-group"},ce={class:"w-32 mt-1 mb-2 mr-2 btn btn-outline-success btn-sm"},me=["src"],de={key:1,class:"pics"},pe=r("p",null,"\u4E3B\u56FE\u53C2\u8003",-1),fe=["onClick"],_e=["src"],ge=M({__name:"goods",setup(U,{expose:x}){const L=O().uploadUrl,a=E({href:"",pic_url:"",id:0,item_id:"",title:"",price:0}),c={},d=E({topic_id:0}),e=E({visible:!1,confirmLoading:!1,data:{previewImg:"",pic_urls:[],wen_items:[]}}),b=()=>{e.visible=!1},h=l=>{a.pic_url=l.data.item.img},f=V(),v=q(c,N(a)),m=l=>{e.visible=!0,j(()=>{Object.assign(a,{href:"",pic_url:"",id:0,item_id:"",title:"",price:0}),d.topic_id=l.id,f.value.reload(!0)})},t=l=>{j(()=>{Object.assign(a,{href:"",pic_url:"",id:0,item_id:"",title:"",price:0});const i=z(l,["id","href","item_id","title","price","pic_url"]);Object.assign(a,i),e.data.pic_urls=[],C()})},s=()=>{if(e.confirmLoading=!0,v.value.$touch(),v.value.$invalid)v.value.$errors,e.confirmLoading=!1;else{const l=F(a);le(Object.assign(l,{topic_id:d.topic_id})).then(i=>{const{code:p}=i||{};p===0?S.success("\u4FDD\u5B58\u6210\u529F"):S.error(i.message),e.confirmLoading=!1,f.value.reload(!0),t({})})}},_=()=>{ne({href:a.href}).then(l=>{l.data.goods&&(j(()=>{Object.assign(a,z(l.data.goods,["href","item_id","title","price","pic_url"]))}),e.data.wen_items=l.data.goods.wen_items||[],e.data.pic_urls=l.data.goods.pic_urls||[]),e.confirmLoading=!1})},C=()=>{!a.href||ae({href:a.href}).then(l=>{l.data.goods&&(e.data.pic_urls=l.data.goods.pic_urls||[])})},B=l=>{j(()=>{a.pic_url=l}),e.data.previewImg=l};return te(()=>a.href,(l,i)=>{C()},{immediate:!0}),x({edit:m}),(l,i)=>{const p=u("h-form-item"),D=u("UploadIcon"),J=u("h-upload"),K=u("h-form"),Q=u("h-spin"),X=u("h-modal");return w(),P(X,{title:"\u4E13\u9898\u5546\u54C1\u7BA1\u7406",size:"modal-xl",visible:e.visible,"confirm-loading":e.confirmLoading,onCancel:b},{footer:o(()=>[r("button",{class:"w-24 mb-2 mr-1 btn btn-primary",onClick:i[4]||(i[4]=g=>s())},"\u4FDD\u5B58")]),default:o(()=>[n(Q,{spinning:e.confirmLoading},{default:o(()=>[n(K,{layout:"small"},{default:o(()=>[n(p,{label:"\u5730\u5740",content:"",layout:"small"},{default:o(()=>[r("div",ue,[k(r("input",{type:"text",class:"form-control","onUpdate:modelValue":i[0]||(i[0]=g=>a.href=g)},null,512),[[y,a.href]]),r("div",{class:"input-group-text"},[r("button",{class:"w-24",onClick:_},"\u83B7\u53D6")])])]),_:1}),n(p,{label:"\u6807\u9898",content:"",layout:"small"},{default:o(()=>[k(r("input",{type:"text",class:"form-control","onUpdate:modelValue":i[1]||(i[1]=g=>a.title=g)},null,512),[[y,a.title]])]),_:1}),n(p,{label:"\u539F\u4EF7\u683C",content:"",layout:"small"},{default:o(()=>[k(r("input",{type:"text",class:"form-control","onUpdate:modelValue":i[2]||(i[2]=g=>a.price=g)},null,512),[[y,a.price]])]),_:1}),n(p,{label:"\u56FE\u7247",content:"",layout:"small"},{default:o(()=>[k(r("input",{type:"text",class:"form-control","onUpdate:modelValue":i[3]||(i[3]=g=>a.pic_url=g),placeholder:""},null,512),[[y,a.pic_url]]),n(J,{name:"file",multiple:!0,action:F(L),onChange:h},{default:o(()=>[r("button",ce,[n(D,{class:"w-4 h-4 mr-2"}),Y("\u4E0A\u4F20 ")])]),_:1},8,["action"]),e.data.previewImg?(w(),A("img",{key:0,class:"previewImg",src:e.data.previewImg},null,8,me)):G("",!0),e.data.pic_urls&&e.data.pic_urls.length>0?(w(),A("div",de,[pe,r("ul",null,[(w(!0),A(W,null,oe(e.data.pic_urls,(g,ee)=>(w(),A("li",{key:ee,onClick:he=>B(g)},[r("img",{src:g},null,8,_e)],8,fe))),128))])])):G("",!0)]),_:1})]),_:1})]),_:1},8,["spinning"])]),_:1},8,["visible","confirm-loading"])}}}),be=M({__name:"items",setup(U,{expose:x}){const $=O(),L=Z(()=>`${$.urlPrefix}${$.apiUrl}${T.getItemsGoods}`),a=H({}),c=[{formatter:"responsiveCollapse",width:40,minWidth:30,hozAlign:"center",resizable:!0,headerSort:!1},{title:"\u6807\u9898",field:"goods.title",formatter(t){return I(`<a target="_blank" href="${t.getData().item_url}">
          ${t.getData().goods.title}
        </a>`)[0]}},{title:"\u4EF7\u683C",field:"goods.price",width:100},{title:"\u56FE\u7247",field:"pic_url",width:100,formatter(t){return I(`<a target="_blank" href="${t.getData().item_url}">
          <img src="${t.getData().goods.pic_url}" />
        </a>`)[0]}},{title:"\u6240\u5C5E\u4E13\u9898",field:"topic.name",width:100}],d=E({rangePicker:"",username:"",status:0,startTime:"",endTime:"",topic_id:""}),e=E({visible:!1,confirmLoading:!1}),b=V(),h=V(),f=()=>{b.value.reload(!0)},v=()=>{e.visible=!1};return x({show:t=>{d.topic_id=t.topic_id,e.visible=!0,f()}}),(t,s)=>{const _=u("h-form-item"),C=u("Litepicker"),B=u("h-form"),l=u("Tablepage"),i=u("h-drawer");return w(),A(W,null,[n(i,{title:"\u4E13\u4EAB\u4EA7\u54C1",size:"modal-xl",visible:e.visible,"confirm-loading":e.confirmLoading,onCancel:v},{header:o(()=>[r("button",{class:"btn btn-primary mr-2 shadow-md",onClick:s[0]||(s[0]=p=>h.value.edit({}))},"\u53D1\u5E03 ")]),default:o(()=>[n(l,{ref_key:"tableRef",ref:b,columns:c,ajaxUrl:F(L),config:F(a),queryParam:d},{search:o(()=>[n(B,{layout:"inline"},{default:o(()=>[n(_,{label:"\u7528\u6237\u540D",content:"",layout:"inline"},{default:o(()=>[k(r("input",{"onUpdate:modelValue":s[1]||(s[1]=p=>d.username=p),type:"text",class:"form-control mt-2 sm:mt-0 sm:w-40 2xl:w-full"},null,512),[[y,d.username]])]),_:1}),n(_,{label:"\u521B\u5EFA\u65F6\u95F4",content:"",layout:"inline"},{default:o(()=>[n(C,{modelValue:d.rangePicker,"onUpdate:modelValue":s[2]||(s[2]=p=>d.rangePicker=p),options:{autoApply:!1,singleMode:!1,numberOfColumns:2,numberOfMonths:2,showWeekNumbers:!0,format:"YYYY-MM-DD",dropdowns:{minYear:1990,maxYear:null,months:!0,years:!0}},class:"form-control mt-2 sm:mt-0 sm:w-56 2xl:w-full"},null,8,["modelValue"])]),_:1}),r("div",{class:"mt-2 xl:mt-0"},[r("button",{type:"button",class:"btn btn-primary w-full sm:w-16",onClick:f}," \u67E5\u8BE2 ")])]),_:1})]),_:1},8,["ajaxUrl","config","queryParam"])]),_:1},8,["visible","confirm-loading"]),n(ge,{ref_key:"goodsModal",ref:h,onOk:f},null,512)],64)}}}),ye=M({__name:"topic",setup(U){const x=O(),$=Z(()=>`${x.urlPrefix}${x.apiUrl}${T.getItems}`),L=H({}),a=[{formatter:"responsiveCollapse",width:40,minWidth:30,hozAlign:"center",resizable:!0,headerSort:!1},{title:"\u6807\u9898",field:"name",width:200},{title:"\u5185\u5BB9",field:"content"},{title:"\u56FE\u7247",field:"pic_url",width:100,formatter(m){return I(`<a target="_blank" href="${m.getData().item_url}">
          <img src="${m.getData().pic_url}" />
        </a>`)[0]}},{title:"\u5546\u54C1\u6570\u91CF",field:"count",width:100},{title:"\u5546\u54C1\u7BA1\u7406",hozAlign:"center",field:"",width:120,formatter(m){if(m.getData().status!=1&&m.getData().status!=2){const t=I('<a class="flex items-center text-center" href="javascript:;">\u7BA1\u7406</a>');return I(t).on("click",function(s){f({topic_id:m.getData().id})}),t[0]}return""}},{title:"\u64CD\u4F5C",hozAlign:"center",width:150,field:"",formatter(m){if(m.getData().status!=1&&m.getData().status!=2){const t=I('<a class="flex items-center" href="javascript:;">\u7F16\u8F91</a>');return I(t).on("click",function(s){v(m.getData())}),t[0]}return""}}],c=E({rangePicker:"",username:"",status:0,startTime:"",endTime:""}),d=V(),e=()=>{d.value.reload(!0)},b=V(),h=V(),f=m=>{h.value.show(m)},v=m=>{b.value.edit(m)};return(m,t)=>{const s=u("h-form-item"),_=u("Litepicker"),C=u("h-form"),B=u("Tablepage"),l=u("h-card");return w(),P(l,{bordered:!1,title:"\u4E13\u9898"},{header:o(()=>[r("button",{class:"btn btn-primary mr-2 shadow-md",onClick:t[0]||(t[0]=i=>b.value.edit({}))},"\u53D1\u5E03\u4E13\u9898 ")]),default:o(()=>[n(B,{ref_key:"tableRef",ref:d,columns:a,ajaxUrl:F($),config:F(L),queryParam:c},{search:o(()=>[n(C,{layout:"inline"},{default:o(()=>[n(s,{label:"\u7528\u6237\u540D",content:"",layout:"inline"},{default:o(()=>[k(r("input",{"onUpdate:modelValue":t[1]||(t[1]=i=>c.username=i),type:"text",class:"form-control mt-2 sm:mt-0 sm:w-40 2xl:w-full"},null,512),[[y,c.username]])]),_:1}),n(s,{label:"\u521B\u5EFA\u65F6\u95F4",content:"",layout:"inline"},{default:o(()=>[n(_,{modelValue:c.rangePicker,"onUpdate:modelValue":t[2]||(t[2]=i=>c.rangePicker=i),options:{autoApply:!1,singleMode:!1,numberOfColumns:2,numberOfMonths:2,showWeekNumbers:!0,format:"YYYY-MM-DD",dropdowns:{minYear:1990,maxYear:null,months:!0,years:!0}},class:"form-control mt-2 sm:mt-0 sm:w-56 2xl:w-full"},null,8,["modelValue"])]),_:1}),r("div",{class:"mt-2 xl:mt-0"},[r("button",{type:"button",class:"btn btn-primary w-full sm:w-16",onClick:e}," \u67E5\u8BE2 ")])]),_:1})]),_:1},8,["ajaxUrl","config","queryParam"]),n(re,{ref_key:"modal",ref:b,onOk:e},null,512),n(be,{ref_key:"itemsModal",ref:h,onOk:e},null,512)]),_:1})}}});export{ye as default};
