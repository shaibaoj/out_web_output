import{h as S,Y as T,D as o,Z as $,j as b,C as q,b as N,w as s,s as h,a as x,p as u,u as i,l as a,m as d,n as P,c as R,e as V,d as F,$ as M,q as A,a1 as O}from"./index.5e15cb45.js";import{c as C,s as Y,d as H,b as I}from"./miniprogram.13425128.js";const G=a("a",{class:"btn",target:"_blank",href:"https://mp.weixin.qq.com/cgi-bin/loginpage?t=wxm2-login&lang=zh_CN"},"\u524D\u5F80\u5FAE\u4FE1\u516C\u4F17\u53F7\u5B8C\u5168\u914D\u7F6E",-1),W={class:"relative flex flex-col justify-center px-5 before:absolute before:top-0 before:bottom-0 before:mt-4 before:hidden before:h-[3px] before:w-[69%] before:bg-slate-100 before:dark:bg-darkmode-400 sm:px-20 lg:flex-row before:lg:block"},Z=a("div",{class:"intro-x z-10 flex flex-1 items-center lg:block lg:text-center"},[a("button",{class:"btn btn-primary h-10 w-10 rounded-full"},"1"),a("div",{class:"ml-3 text-base font-medium lg:mx-auto lg:mt-3 lg:w-32"}," \u6A21\u677F\u63D0\u4EA4 ")],-1),J=a("div",{class:"intro-x z-10 mt-5 flex flex-1 items-center lg:mt-0 lg:block lg:text-center"},[a("button",{class:"btn h-10 w-10 rounded-full bg-slate-100 text-slate-500 dark:border-darkmode-400 dark:bg-darkmode-400"}," 2 "),a("div",{class:"ml-3 text-base text-slate-600 dark:text-slate-400 lg:mx-auto lg:mt-3 lg:w-32"}," \u5F85\u5FAE\u4FE1\u5BA1\u6838\u901A\u8FC7\uFF0C\u5373\u53EF\u53D1\u5E03\u4E0A\u7EBF ")],-1),K={class:"intro-x z-10 mt-5 flex flex-1 items-center lg:mt-0 lg:block lg:text-center"},Q=a("button",{class:"btn h-10 w-10 rounded-full bg-slate-100 text-slate-500 dark:border-darkmode-400 dark:bg-darkmode-400"}," 3 ",-1),X={class:"ml-3 text-base text-slate-600 dark:text-slate-400 lg:mx-auto lg:mt-3 lg:w-32"},ee=a("p",null,"\u6700\u8FD1\u63D0\u4EA4\u5BA1\u6838\u8BB0\u5F55",-1),se=S({__name:"template",setup(te){const c=T(),E=o(()=>`${c.miniProgramUrl}${C.getItems}`),f=$({}),v=[{formatter:"responsiveCollapse",width:40,minWidth:30,hozAlign:"center",resizable:!0,headerSort:!1},{title:"\u7F16\u53F7",width:100,field:"template_id"},{title:"\u7248\u672C",width:100,field:"user_version"},{title:"\u5907\u6CE8",field:"user_desc"},{title:"\u64CD\u4F5C",field:"action",width:120,hozAlign:"center",formatter(t){const r=F('<a class="flex items-center" href="javascript:;">\u901A\u8FC7</a>');return F(r).on("click",function(n){w(t.getData())}),r[0]}}],l=b({platform_type:100}),D=t=>I(Object.assign(t,l)).then(r=>(r.data.api_miniprogram_user&&r.data.api_miniprogram_user.id&&(r.data.api_miniprogram_user.status>-2&&(e.modal.status=!0),e.api_miniprogram_user=r.data.api_miniprogram_user),r.data.logs&&(e.data.logs=r.data.logs),{items:r.data.items.template_list.reverse(),pager:{ipage:1,count:20}})),e=b({modal:{template:{template_id:"",user_version:"",user_desc:""},ModalText:"",visible:!1,confirmLoading:!1,error:!1,status:!1},submit:{error:""},api_miniprogram_user:{status:0,status_reason:0,id:""},data:{logs:[]}}),k=o(()=>`${c.miniProgramUrl}${C.getRelease}`),B=[{title:"\u65F6\u95F4",width:140,field:"created_at",formatter(t){return M(t.getData().created_at,"YY-MM-DD HH:mm")},hozAlign:"center"},{title:"\u6A21\u677F\u7F16\u53F7",field:"template_id",hozAlign:"center",width:100},{title:"\u72B6\u6001",field:"",hozAlign:"center",width:120,formatter(t){return t.getData().status===0?"\u5BA1\u6838\u4E2D":t.getData().status===-1?"\u62D2\u7EDD":"\u5BA1\u6838\u901A\u8FC7"}},{title:"\u5907\u6CE8",field:"user_desc"}];o(()=>{if(e.api_miniprogram_user.id){if(e.api_miniprogram_user.status===1||e.api_miniprogram_user.status===2)return 2;if(e.api_miniprogram_user.status===0||e.api_miniprogram_user.status===-1)return 1}return 0}),o(()=>e.api_miniprogram_user.id&&e.api_miniprogram_user.status_reason&&e.api_miniprogram_user.status===-1?e.api_miniprogram_user.status_reason:"\u5F85\u5FAE\u4FE1\u5BA1\u6838\u901A\u8FC7\uFF0C\u5373\u53EF\u53D1\u5E03\u4E0A\u7EBF"),o(()=>{if(e.api_miniprogram_user.id){if(e.api_miniprogram_user.status===-1)return"\u5BA1\u6838\u62D2\u7EDD";if(e.api_miniprogram_user.status===0)return"\u5BA1\u6838\u4E2D";if(e.api_miniprogram_user.status===1)return"\u6A21\u677F\u5BA1\u6838\u901A\u8FC7"}return"\u7B49\u5F85\u5BA1\u6838"});const g=q(),_=()=>{D(l)},w=t=>{e.modal.visible=!0,e.modal.template=t},z=()=>{e.modal.confirmLoading=!0,Y({template_id:e.modal.template.template_id,user_version:e.modal.template.user_version,user_desc:e.modal.template.user_desc}).then(t=>{e.modal.confirmLoading=!1,e.modal.visible=!1,t.code>0?(e.submit.error=t.message||"",e.modal.error=!0):A.success(t.message),_()})},j=()=>{e.modal.visible=!1},p=()=>{e.modal.error=!1},y=()=>{H({}).then(t=>{e.modal.confirmLoading=!1,e.modal.visible=!1,t.code>0?(e.submit.error=t.message||"",e.modal.error=!0):A.success(t.message),_()})},L=()=>{e.modal.status=!1};return(t,r)=>{const n=O,m=h("h-modal"),U=h("h-card");return x(),N(U,{bordered:!1,title:"\u6A21\u7248\u8BBE\u7F6E"},{default:s(()=>[u(n,{ref_key:"tableRef",ref:g,columns:v,ajaxUrl:i(E),config:i(f),queryParam:l},null,8,["ajaxUrl","config","queryParam"]),u(m,{title:"\u786E\u8BA4\u662F\u5426\u9009\u62E9\u8BE5\u7248\u672C",visible:e.modal.visible,"confirm-loading":e.modal.confirmLoading,onOk:z,onCancel:j},{default:s(()=>[a("p",null,d(e.modal.template.user_version)+" "+d(e.modal.template.user_desc),1)]),_:1},8,["visible","confirm-loading"]),u(m,{title:"\u63D0\u9192",visible:e.modal.error,"confirm-loading":e.modal.confirmLoading,onCancel:p},{footer:s(()=>[a("button",{class:"btn btn-primary mb-2 mr-1 w-24",onClick:p},"\u5173\u95ED")]),default:s(()=>[a("div",null,[a("p",null,d(e.submit.error),1),G])]),_:1},8,["visible","confirm-loading"]),u(m,{title:"\u64CD\u4F5C\u7ED3\u679C",size:"modal-lg",visible:e.modal.status,"confirm-loading":e.modal.confirmLoading,onCancel:L},{footer:s(()=>[ee,u(n,{ref_key:"tableRef",ref:g,columns:B,ajaxUrl:i(k),config:i(f)},null,8,["ajaxUrl","config"])]),default:s(()=>[a("div",W,[Z,J,a("div",K,[Q,a("div",X,[P(" \u5BA1\u6838\u901A\u8FC7 "),e.api_miniprogram_user.status==1?(x(),R("button",{key:0,onClick:y},"\u7ACB\u5373\u6A21\u677F\u4E0A\u7EBF")):V("",!0)])])])]),_:1},8,["visible","confirm-loading"])]),_:1})}}});export{se as default};
