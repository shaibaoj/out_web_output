import{h as g,j as y,D as A,E as k,q as p,b as h,w as a,aB as v,s as _,a as r,c as z,l as u,e as d,p as s,m as o,n as m,u as D}from"./index.729dcb01.js";import{g as q,a as V}from"./miniprogram.7d224dd7.js";const N={key:0,class:"login"},S=["href"],j=u("p",null,[m("\u6388\u6743\u5C0F\u7A0B\u5E8F\u4E4B\u524D\uFF0C\u8BF7\u5148\u524D\u5F80\u5FAE\u4FE1\u516C\u4F17\u53F7\u5E73\u53F0\u521B\u5EFA\u597D\u5C0F\u7A0B\u5E8F,"),u("a",{href:"https://mp.weixin.qq.com/",target:"_blank"},"\u300B\u300B\u5FAE\u4FE1\u516C\u4F17\u53F7\u5E73\u53F0")],-1),M={class:"expire"},R=["href"],T={class:"expire"},U={class:"expire"},G={class:"expire"},H={class:"app-icon"},I=["src"],J={class:"expire"},K={class:"expire"},L=u("div",null,[u("p",null,"\u786E\u8BA4\u5DF2\u7ECF\u5B8C\u6210\u6388\u6743")],-1),X=g({__name:"dashboard",setup(O){const i=v(),e=y({user_wp:{service_type_info:"",auth_date:"",nick_name:"",user_name:"",principal_name:"",head_img:"",authorizer_appid:""},authorize_url:"",modal:{auth:!1},weixin:{auth_code:"",expires_in:"",authorize:!1},auth:0}),f=A(()=>{if(e.user_wp.service_type_info){if(e.user_wp.service_type_info==="0")return"\u8BA2\u9605\u53F7";if(e.user_wp.service_type_info==="1")return"\u8001\u8BA2\u9605\u53F7";if(e.user_wp.service_type_info==="2")return"\u670D\u52A1\u53F7"}return""});k(()=>{i.query.auth_code&&(e.weixin.auth_code=i.query.auth_code.toString(),e.weixin.authorize=!0),i.query.expires_in&&(e.weixin.expires_in=i.query.expires_in.toString()),F()});const F=()=>{l(),e.weixin.authorize&&B()},l=()=>{q({platform_type:101}).then(t=>{t.data.item?(e.user_wp=t.data.item,e.auth=1):e.auth=-1,t.data,t.data.authorize_url&&(e.authorize_url=t.data.authorize_url),t.message&&p.success(t.message)})},B=()=>{V({auth_code:e.weixin.auth_code,expires_in:e.weixin.expires_in}).then(t=>{t.data.item?(e.user_wp=t.data.item,e.modal.auth=!0):p.success(t.message)})},c=()=>{e.modal.auth=!0},w=()=>{e.modal.auth=!1},C=()=>{e.modal.auth=!1,l()};return(t,P)=>{const n=_("h-form-item"),b=_("h-form"),x=_("h-modal"),E=_("h-card");return r(),h(E,{bordered:!1,title:"\u5C0F\u7A0B\u5E8F\u6388\u6743"},{default:a(()=>[e.auth<0?(r(),z("div",N,[u("p",null,[u("a",{class:"btn",target:"_blank",href:e.authorize_url,onClick:c},"\u6388\u6743\u5C0F\u7A0B\u5E8F",8,S)]),j])):d("",!0),e.auth>0?(r(),h(b,{key:1},{default:a(()=>[s(n,{label:"\u6388\u6743\u65F6\u95F4:",content:""},{default:a(()=>[u("span",M,o(e.user_wp.auth_date),1),u("p",null,[u("a",{class:"w-24 mb-2 mr-1 btn btn-primary",target:"_blank",href:e.authorize_url,onClick:c},"\u91CD\u65B0\u6388\u6743",8,R),m(" (\u5982\u8BEF\u5220\u5C0F\u7A0B\u5E8F\u6388\u6743\uFF0C\u8BF7\u91CD\u65B0\u6388\u6743) ")])]),_:1}),s(n,{label:"\u5C0F\u7A0B\u5E8F:",content:""},{default:a(()=>[u("span",T,o(e.user_wp.nick_name),1)]),_:1}),s(n,{label:"user_name:",content:""},{default:a(()=>[u("span",U,o(e.user_wp.user_name),1)]),_:1}),s(n,{label:"appid:",content:""},{default:a(()=>[u("span",G,o(e.user_wp.authorizer_appid),1)]),_:1}),s(n,{label:"\u5934\u50CF:",content:""},{default:a(()=>[u("div",null,[u("div",H,[u("img",{src:e.user_wp.head_img},null,8,I)])])]),_:1}),s(n,{label:"\u5E10\u53F7\u7C7B\u578B:",content:""},{default:a(()=>[u("span",J,o(D(f)),1)]),_:1}),s(n,{label:"\u4E3B\u4F53:",content:""},{default:a(()=>[u("span",K,o(e.user_wp.principal_name),1)]),_:1})]),_:1})):d("",!0),s(x,{title:"\u6388\u6743",visible:e.modal.auth,onCancel:w},{footer:a(()=>[u("button",{class:"w-24 mb-2 mr-1 btn btn-primary",onClick:C},"\u5237\u65B0")]),default:a(()=>[L]),_:1},8,["visible"])]),_:1})}}});export{X as default};
