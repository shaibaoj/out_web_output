import{r as R,h as M,Y as O,j as E,k as q,t as N,a as x,b as P,w as s,l,n as G,e as T,p as i,x as _,y as g,u as U,v as j,q as S,s as d,C as L,am as ot,c as A,F as W,I as nt,D as Z,Z as H,d as B,a1 as J}from"./index.5e15cb45.js";import{p as z}from"./pick.82223447.js";import{f as at,a as lt}from"./goods.a790bda1.js";const Y={getItems:"/api/user/market/topic/list",getView:"/api/user/market/topic/view",updateItem:"/api/user/market/topic/update",getItemsGoods:"/api/user/market/topic/topic_items",updateGoods:"/api/user/market/topic/update_goods",updateStatus:"/api/user/market/topic/updateStatus"};function st(F){return R({url:Y.updateGoods,method:"post",data:F})}function it(F){return R({url:Y.updateItem,method:"post",data:F})}const ut={class:"w-32 mt-1 mb-2 mr-2 btn btn-outline-success btn-sm"},rt=M({__name:"topic",emits:["ok"],setup(F,{expose:C,emit:$}){const o=O().uploadUrl,r=E({id:0,classes:"",name:"",content:"",pic_url:""}),p={},t=E({visible:!1,confirmLoading:!1}),w=()=>{t.visible=!1},y=e=>{r.pic_url=e.data.item.img},b=q(p,N(r)),k=e=>{t.visible=!0,Object.assign(r,{id:0,classes:"",name:"",content:"",pic_url:""}),j(()=>{Object.assign(r,z(e,["id","name","content","pic_url"]))})},c=()=>{if(t.confirmLoading=!0,b.value.$touch(),b.value.$invalid)b.value.$errors,t.confirmLoading=!1;else{const e=U(r);it(e).then(n=>{const{code:h}=n||{};h===0?S.success("\u4FDD\u5B58\u6210\u529F"):S.error(n.message),t.confirmLoading=!1,$("ok",e),t.visible=!1})}};return C({edit:k}),(e,n)=>{const h=d("h-form-item"),D=d("UploadIcon"),V=d("h-upload"),u=d("h-form"),a=d("LoadingIcon"),f=d("h-modal");return x(),P(f,{title:"\u53D1\u5E03\u4E13\u9898",size:"modal-lg",visible:t.visible,"confirm-loading":t.confirmLoading,onCancel:w},{footer:s(()=>[l("button",{class:"w-24 mb-2 mr-1 btn btn-primary",onClick:n[5]||(n[5]=v=>c())},[G(" \u4FDD\u5B58 "),t.confirmLoading?(x(),P(a,{key:0,icon:"oval",color:"white",class:"w-4 h-4 ml-2"})):T("",!0)])]),default:s(()=>[i(u,{layout:"small"},{default:s(()=>[_(l("input",{"onUpdate:modelValue":n[0]||(n[0]=v=>r.id=v),type:"hidden"},null,512),[[g,r.id]]),_(l("input",{"onUpdate:modelValue":n[1]||(n[1]=v=>r.classes=v),type:"hidden"},null,512),[[g,r.classes]]),i(h,{label:"\u4E13\u9898\u540D\u79F0",content:"",layout:"small"},{default:s(()=>[_(l("input",{type:"text",class:"form-control","onUpdate:modelValue":n[2]||(n[2]=v=>r.name=v)},null,512),[[g,r.name]])]),_:1}),i(h,{label:"\u5185\u5BB9",content:"",layout:"small"},{default:s(()=>[_(l("textarea",{class:"form-control","onUpdate:modelValue":n[3]||(n[3]=v=>r.content=v),rows:4},null,512),[[g,r.content]])]),_:1}),i(h,{label:"\u56FE\u7247",content:"",layout:"small"},{default:s(()=>[_(l("input",{type:"text",class:"form-control","onUpdate:modelValue":n[4]||(n[4]=v=>r.pic_url=v),placeholder:""},null,512),[[g,r.pic_url]]),i(V,{name:"file",multiple:!0,action:U(o),onChange:y},{default:s(()=>[l("button",ut,[i(D,{class:"w-4 h-4 mr-2"}),G("\u4E0A\u4F20 ")])]),_:1},8,["action"])]),_:1})]),_:1})]),_:1},8,["visible","confirm-loading"])}}}),ct={class:"input-group"},dt={class:"w-32 mt-1 mb-2 mr-2 btn btn-outline-success btn-sm"},mt=["src"],pt={key:1,class:"pics"},ft=l("p",null,"\u4E3B\u56FE\u53C2\u8003",-1),_t=["onClick"],gt=["src"],bt=M({__name:"goods",setup(F,{expose:C}){const I=O().uploadUrl,o=E({href:"",pic_url:"",id:0,num_iid:"",title:"",price:0}),r={},p=E({topic_id:0}),t=E({visible:!1,confirmLoading:!1,data:{previewImg:"",pic_urls:[],wen_items:[]}}),w=()=>{t.visible=!1},y=u=>{o.pic_url=u.data.item.img},b=L(),k=q(r,N(o)),c=u=>{t.visible=!0,j(()=>{Object.assign(o,{href:"",pic_url:"",id:0,num_iid:"",title:"",price:0}),p.topic_id=u.id,b.value.reload(!0)})},e=u=>{j(()=>{Object.assign(o,{href:"",pic_url:"",id:0,num_iid:"",title:"",price:0});const a=z(u,["id","href","num_iid","title","price","pic_url"]);Object.assign(o,a),t.data.pic_urls=[],D()})},n=()=>{if(t.confirmLoading=!0,k.value.$touch(),k.value.$invalid)k.value.$errors,t.confirmLoading=!1;else{const u=U(o);st(Object.assign(u,{topic_id:p.topic_id})).then(a=>{const{code:f}=a||{};f===0?S.success("\u4FDD\u5B58\u6210\u529F"):S.error(a.message),t.confirmLoading=!1,b.value.reload(!0),e({})})}},h=()=>{at({href:o.href}).then(u=>{u.data.goods&&(j(()=>{Object.assign(o,z(u.data.goods,["href","num_iid","title","price","pic_url"]))}),t.data.wen_items=u.data.goods.wen_items||[],t.data.pic_urls=u.data.goods.pic_urls||[]),t.confirmLoading=!1})},D=()=>{!o.href||lt({href:o.href}).then(u=>{u.data.goods&&(t.data.pic_urls=u.data.goods.pic_urls||[])})},V=u=>{j(()=>{o.pic_url=u}),t.data.previewImg=u};return ot(()=>o.href,(u,a)=>{D()},{immediate:!0}),C({edit:c}),(u,a)=>{const f=d("h-form-item"),v=d("UploadIcon"),K=d("h-upload"),Q=d("h-form"),X=d("h-spin"),tt=d("h-modal");return x(),P(tt,{title:"\u4E13\u9898\u5546\u54C1\u7BA1\u7406",size:"modal-xl",visible:t.visible,"confirm-loading":t.confirmLoading,onCancel:w},{footer:s(()=>[l("button",{class:"w-24 mb-2 mr-1 btn btn-primary",onClick:a[6]||(a[6]=m=>n())},"\u4FDD\u5B58")]),default:s(()=>[i(X,{spinning:t.confirmLoading},{default:s(()=>[i(Q,{layout:"small"},{default:s(()=>[_(l("input",{"onUpdate:modelValue":a[0]||(a[0]=m=>o.id=m),type:"hidden"},null,512),[[g,o.id]]),_(l("input",{"onUpdate:modelValue":a[1]||(a[1]=m=>o.num_iid=m),type:"hidden"},null,512),[[g,o.num_iid]]),i(f,{label:"\u5730\u5740",content:"",layout:"small"},{default:s(()=>[l("div",ct,[_(l("input",{type:"text",class:"form-control","onUpdate:modelValue":a[2]||(a[2]=m=>o.href=m)},null,512),[[g,o.href]]),l("div",{class:"input-group-text"},[l("button",{class:"w-24",onClick:h},"\u83B7\u53D6")])])]),_:1}),i(f,{label:"\u6807\u9898",content:"",layout:"small"},{default:s(()=>[_(l("input",{type:"text",class:"form-control","onUpdate:modelValue":a[3]||(a[3]=m=>o.title=m)},null,512),[[g,o.title]])]),_:1}),i(f,{label:"\u539F\u4EF7\u683C",content:"",layout:"small"},{default:s(()=>[_(l("input",{type:"text",class:"form-control","onUpdate:modelValue":a[4]||(a[4]=m=>o.price=m)},null,512),[[g,o.price]])]),_:1}),i(f,{label:"\u56FE\u7247",content:"",layout:"small"},{default:s(()=>[_(l("input",{type:"text",class:"form-control","onUpdate:modelValue":a[5]||(a[5]=m=>o.pic_url=m),placeholder:""},null,512),[[g,o.pic_url]]),i(K,{name:"file",multiple:!0,action:U(I),onChange:y},{default:s(()=>[l("button",dt,[i(v,{class:"w-4 h-4 mr-2"}),G("\u4E0A\u4F20 ")])]),_:1},8,["action"]),t.data.previewImg?(x(),A("img",{key:0,class:"previewImg",src:t.data.previewImg},null,8,mt)):T("",!0),t.data.pic_urls&&t.data.pic_urls.length>0?(x(),A("div",pt,[ft,l("ul",null,[(x(!0),A(W,null,nt(t.data.pic_urls,(m,et)=>(x(),A("li",{key:et,onClick:vt=>V(m)},[l("img",{src:m},null,8,gt)],8,_t))),128))])])):T("",!0)]),_:1})]),_:1})]),_:1},8,["spinning"])]),_:1},8,["visible","confirm-loading"])}}}),ht=M({__name:"items",setup(F,{expose:C}){const $=O(),I=Z(()=>`${$.urlPrefix}${$.apiUrl}${Y.getItemsGoods}`),o=H({}),r=[{formatter:"responsiveCollapse",width:40,minWidth:30,hozAlign:"center",resizable:!0,headerSort:!1},{title:"\u6807\u9898",field:"goods.title",formatter(e){return B(`<a target="_blank" href="${e.getData().item_url}">
          ${e.getData().goods.title}
        </a>`)[0]}},{title:"\u4EF7\u683C",field:"goods.price",width:100},{title:"\u56FE\u7247",field:"pic_url",width:100,formatter(e){return B(`<a target="_blank" href="${e.getData().item_url}">
          <img src="${e.getData().goods.pic_url}" />
        </a>`)[0]}},{title:"\u6240\u5C5E\u4E13\u9898",field:"topic.name",width:100}],p=E({rangePicker:"",username:"",status:0,startTime:"",endTime:"",topic_id:""}),t=E({visible:!1,confirmLoading:!1}),w=L(),y=L(),b=()=>{w.value.reload(!0)},k=()=>{t.visible=!1};return C({show:e=>{p.topic_id=e.topic_id,t.visible=!0,b()}}),(e,n)=>{const h=d("h-form-item"),D=d("Litepicker"),V=d("h-form"),u=J,a=d("h-drawer");return x(),A(W,null,[i(a,{title:"\u4E13\u4EAB\u4EA7\u54C1",size:"modal-xl",visible:t.visible,"confirm-loading":t.confirmLoading,onCancel:k},{header:s(()=>[l("button",{class:"btn btn-primary mr-2 shadow-md",onClick:n[0]||(n[0]=f=>y.value.edit({}))},"\u53D1\u5E03 ")]),default:s(()=>[i(u,{ref_key:"tableRef",ref:w,columns:r,ajaxUrl:U(I),config:U(o),queryParam:p},{search:s(()=>[i(V,{layout:"inline"},{default:s(()=>[i(h,{label:"\u7528\u6237\u540D",content:"",layout:"inline"},{default:s(()=>[_(l("input",{"onUpdate:modelValue":n[1]||(n[1]=f=>p.username=f),type:"text",class:"form-control mt-2 sm:mt-0 sm:w-40 2xl:w-full"},null,512),[[g,p.username]])]),_:1}),i(h,{label:"\u521B\u5EFA\u65F6\u95F4",content:"",layout:"inline"},{default:s(()=>[i(D,{modelValue:p.rangePicker,"onUpdate:modelValue":n[2]||(n[2]=f=>p.rangePicker=f),options:{autoApply:!1,singleMode:!1,numberOfColumns:2,numberOfMonths:2,showWeekNumbers:!0,format:"YYYY-MM-DD",dropdowns:{minYear:1990,maxYear:null,months:!0,years:!0}},class:"form-control mt-2 sm:mt-0 sm:w-56 2xl:w-full"},null,8,["modelValue"])]),_:1}),l("div",{class:"mt-2 xl:mt-0"},[l("button",{type:"button",class:"btn btn-primary w-full sm:w-16",onClick:b}," \u67E5\u8BE2 ")])]),_:1})]),_:1},8,["ajaxUrl","config","queryParam"])]),_:1},8,["visible","confirm-loading"]),i(bt,{ref_key:"goodsModal",ref:y,onOk:b},null,512)],64)}}}),xt=M({__name:"topic",setup(F){const C=O(),$=Z(()=>`${C.urlPrefix}${C.apiUrl}${Y.getItems}`),I=H({}),o=[{formatter:"responsiveCollapse",width:40,minWidth:30,hozAlign:"center",resizable:!0,headerSort:!1},{title:"\u6807\u9898",field:"name",width:200},{title:"\u5185\u5BB9",field:"content"},{title:"\u56FE\u7247",field:"pic_url",width:100,formatter(c){return B(`<a target="_blank" href="${c.getData().item_url}">
          <img src="${c.getData().pic_url}" />
        </a>`)[0]}},{title:"\u5546\u54C1\u6570\u91CF",field:"count",width:100},{title:"\u5546\u54C1\u7BA1\u7406",hozAlign:"center",field:"",width:120,formatter(c){if(c.getData().status!=1&&c.getData().status!=2){const e=B('<a class="flex items-center text-center" href="javascript:;">\u7BA1\u7406</a>');return B(e).on("click",function(n){b({topic_id:c.getData().id})}),e[0]}return""}},{title:"\u64CD\u4F5C",hozAlign:"center",width:150,field:"",formatter(c){if(c.getData().status!=1&&c.getData().status!=2){const e=B('<a class="flex items-center" href="javascript:;">\u7F16\u8F91</a>');return B(e).on("click",function(n){k(c.getData())}),e[0]}return""}}],r=E({rangePicker:"",username:"",status:0,startTime:"",endTime:""}),p=L(),t=()=>{p.value.reload(!0)},w=L(),y=L(),b=c=>{y.value.show(c)},k=c=>{w.value.edit(c)};return(c,e)=>{const n=d("h-form-item"),h=d("Litepicker"),D=d("h-form"),V=J,u=d("h-card");return x(),P(u,{bordered:!1,title:"\u4E13\u9898"},{header:s(()=>[l("button",{class:"btn btn-primary mr-2 shadow-md",onClick:e[0]||(e[0]=a=>w.value.edit({}))},"\u53D1\u5E03\u4E13\u9898 ")]),default:s(()=>[i(V,{ref_key:"tableRef",ref:p,columns:o,ajaxUrl:U($),config:U(I),queryParam:r},{search:s(()=>[i(D,{layout:"inline"},{default:s(()=>[i(n,{label:"\u7528\u6237\u540D",content:"",layout:"inline"},{default:s(()=>[_(l("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>r.username=a),type:"text",class:"form-control mt-2 sm:mt-0 sm:w-40 2xl:w-full"},null,512),[[g,r.username]])]),_:1}),i(n,{label:"\u521B\u5EFA\u65F6\u95F4",content:"",layout:"inline"},{default:s(()=>[i(h,{modelValue:r.rangePicker,"onUpdate:modelValue":e[2]||(e[2]=a=>r.rangePicker=a),options:{autoApply:!1,singleMode:!1,numberOfColumns:2,numberOfMonths:2,showWeekNumbers:!0,format:"YYYY-MM-DD",dropdowns:{minYear:1990,maxYear:null,months:!0,years:!0}},class:"form-control mt-2 sm:mt-0 sm:w-56 2xl:w-full"},null,8,["modelValue"])]),_:1}),l("div",{class:"mt-2 xl:mt-0"},[l("button",{type:"button",class:"btn btn-primary w-full sm:w-16",onClick:t}," \u67E5\u8BE2 ")])]),_:1})]),_:1},8,["ajaxUrl","config","queryParam"]),i(rt,{ref_key:"modal",ref:w,onOk:t},null,512),i(ht,{ref_key:"itemsModal",ref:y,onOk:t},null,512)]),_:1})}}});export{xt as default};
