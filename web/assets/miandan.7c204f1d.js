import{h as Z,Y as J,j as Y,D as K,E as st,k as it,t as rt,am as q,a as g,b as $,w as i,l as u,n as G,e as b,p as r,x as d,y as m,c as y,u as V,F as P,I as O,a2 as Q,m as h,v as C,q as S,s as D,Z as dt,o as mt,C as X,d as _,an as H,$ as ct,a1 as pt}from"./index.5e15cb45.js";import{u as ft,f as _t,a as gt,b as ht,c as Dt,g as yt,d as vt,e as bt}from"./goods.a790bda1.js";import{g as wt,i as Ft}from"./common.2ac5c50b.js";import{p as L}from"./pick.82223447.js";const Et={class:"input-group"},xt={class:"input-group"},Ct=u("div",{class:"form-help"},"\u8FD8\u53EF\u4EE5\u8F93\u5165 16 \u4E2A\u5B57",-1),kt={class:"w-32 mt-1 mb-2 mr-2 btn btn-outline-success btn-sm"},Bt=["src"],$t={key:1},Vt=u("p",null,"\u4E3B\u56FE\u53C2\u8003",-1),Ut={class:"flex flex-row flex-wrap"},At=["onClick"],jt=["src"],qt=u("div",{class:"form-help"},"\u963F\u91CC\u5988\u5988\u4F18\u60E0\u5238\u5EFA\u8BAE\u65F6\u95F47\u5929\u5DE6\u53F3",-1),Pt=u("option",{value:0},"--\u9009\u62E9--",-1),Lt=["value"],Yt={key:0},St=u("p",null,"\u5907\u9009\u6587\u6848",-1),Mt={class:"flex flex-col gap-y-3"},Nt=["onClick"],It=["className"],Tt=Z({__name:"miandan",emits:["ok"],setup(tt,{expose:U,emit:M}){const N=J().uploadUrl,t=Y({href:"",qq_video_url:"",coupon_url:"",money:0,id:0,num_iid:"",user_num_id:"",ori_price:0,user_type:0,volume:0,condition:0,title:"",price:0,qq_pic_url:"",comment:"",cid1:0,d_title:"",pic_url:"",create_time:"",end_time:""}),c={},n=Y({visible:!1,confirmLoading:!1,data:{hrefPreview:"",contentPreview:"",step:0,cats:[],wen_items:[],pic_urls:[]}}),A=K(()=>!Ft(t.pic_url));st(()=>{k()});const k=()=>{wt({}).then(l=>{l.data.items&&(n.data.cats=l.data.items)})},w=it(c,rt(t)),F=l=>{n.data.step=0,n.data.contentPreview="",n.data.hrefPreview="",n.visible=!0,C(()=>{Object.assign(t,{href:"",qq_video_url:"",coupon_url:"",money:0,id:0,num_iid:"",user_num_id:"",ori_price:0,user_type:0,volume:0,condition:0,title:"",price:0,qq_pic_url:"",comment:"",cid1:0,d_title:"",pic_url:"",create_time:"",end_time:""}),n.data.pic_urls=[],n.data.wen_items=[],l.id&&(n.data.step=1);const o=L(l,["id","cid1","coupon_url","href","num_iid","title","d_title","price","pic_url","user_num_id","ori_price","user_type","volume","comment","create_time","end_time","money","condition"]);Object.assign(t,o),p()})},B=l=>{if(n.confirmLoading=!0,w.value.$touch(),w.value.$invalid)w.value.$errors,n.confirmLoading=!1;else{const o=V(t);ft(Object.assign(o,{submitStatus:l})).then(f=>{f.code===0&&(l===1?S.success("\u63D0\u4EA4\u6210\u529F"):S.success("\u4FDD\u5B58\u6210\u529F"),M("ok",o),n.visible=!1),n.confirmLoading=!1})}},e=l=>{t.pic_url=l.data.item.img},s=()=>{_t({href:t.href}).then(l=>{l.data.goods&&(C(()=>{Object.assign(t,L(l.data.goods,["id","cid1","coupon_url","href","num_iid","title","d_title","price","pic_url","user_num_id","ori_price","user_type","volume","comment"]))}),n.data.wen_items=l.data.goods.wen_items||[],n.data.pic_urls=l.data.goods.pic_urls||[]),n.confirmLoading=!1})},p=()=>{gt({href:t.href}).then(l=>{l.data.goods&&(n.data.wen_items=l.data.goods.wen_items||[],n.data.pic_urls=l.data.goods.pic_urls||[])})},E=()=>{Dt({href:t.href,coupon_url:t.coupon_url}).then(l=>{l.data.coupon&&C(()=>{const o=L(l.data.coupon,["create_time","end_time","money","condition"]);Object.assign(t,o)})})},I=()=>{n.visible=!1},T=l=>{C(()=>{Object.assign(t,{comment:l.content})})},v=l=>{C(()=>{t.pic_url=l})},j=()=>{ht({href:n.data.hrefPreview,content:n.data.contentPreview}).then(l=>{l.data.item&&C(()=>{const o=L(l.data.item,["href","coupon_url"]);Object.assign(t,o),n.data.step=1,s(),E()})})};return q(()=>t.href,(l,o)=>{p()},{immediate:!0}),q(()=>t.coupon_url,(l,o)=>{E()},{immediate:!0}),q(()=>n.data.hrefPreview,(l,o)=>{j()},{immediate:!0}),q(()=>n.data.contentPreview,(l,o)=>{j()},{immediate:!0}),U({edit:F}),(l,o)=>{const f=D("h-form-item"),et=D("UploadIcon"),ot=D("h-upload"),z=D("Litepicker"),ut=D("h-form"),at=D("h-spin"),W=D("LoadingIcon"),nt=D("h-modal");return g(),$(nt,{title:"\u53D1\u5E03\u514D\u5355\u5546\u54C1",size:"modal-xl",visible:n.visible,"confirm-loading":n.confirmLoading,onCancel:I},{footer:i(()=>[u("div",{className:n.data.step===0?"hidden":""},[u("button",{class:"w-24 mb-2 mr-1 btn btn-primary",onClick:o[21]||(o[21]=a=>B(1))},[G(" \u63D0\u4EA4\u5BA1\u6838 "),n.confirmLoading?(g(),$(W,{key:0,icon:"oval",color:"white",class:"w-4 h-4 ml-2"})):b("",!0)]),u("button",{class:"w-24 mb-2 mr-1 btn btn-primary",onClick:o[22]||(o[22]=a=>B(0))},[G("\u4FDD\u5B58\u8349\u7A3F "),n.confirmLoading?(g(),$(W,{key:0,icon:"oval",color:"white",class:"w-4 ml-2"})):b("",!0)])],8,It)]),default:i(()=>[r(at,{spinning:n.confirmLoading},{default:i(()=>[r(ut,{layout:"small"},{default:i(()=>[n.data.step==0?(g(),$(f,{key:0,label:"\u5546\u54C1\u94FE\u63A5",content:"",layout:"small"},{default:i(()=>[u("div",Et,[d(u("input",{type:"text",class:"form-control","onUpdate:modelValue":o[0]||(o[0]=a=>n.data.hrefPreview=a),onChange:j},null,544),[[m,n.data.hrefPreview]]),u("div",{class:"input-group-text"},[u("button",{class:"w-24",onClick:j},"\u83B7\u53D6")])])]),_:1})):b("",!0),n.data.step!==0?(g(),y(P,{key:1},[d(u("input",{"onUpdate:modelValue":o[1]||(o[1]=a=>t.id=a),type:"hidden"},null,512),[[m,t.id]]),d(u("input",{"onUpdate:modelValue":o[2]||(o[2]=a=>t.num_iid=a),type:"hidden"},null,512),[[m,t.num_iid]]),d(u("input",{"onUpdate:modelValue":o[3]||(o[3]=a=>t.user_num_id=a),type:"hidden"},null,512),[[m,t.user_num_id]]),d(u("input",{"onUpdate:modelValue":o[4]||(o[4]=a=>t.ori_price=a),type:"hidden"},null,512),[[m,t.ori_price]]),d(u("input",{"onUpdate:modelValue":o[5]||(o[5]=a=>t.user_type=a),type:"hidden"},null,512),[[m,t.user_type]]),d(u("input",{"onUpdate:modelValue":o[6]||(o[6]=a=>t.volume=a),type:"hidden"},null,512),[[m,t.volume]]),d(u("input",{"onUpdate:modelValue":o[7]||(o[7]=a=>t.condition=a),type:"hidden"},null,512),[[m,t.condition]]),d(u("input",{"onUpdate:modelValue":o[8]||(o[8]=a=>t.money=a),type:"hidden"},null,512),[[m,t.money]]),r(f,{label:"\u5546\u54C1\u5730\u5740",content:"",layout:"small"},{default:i(()=>[u("div",xt,[d(u("input",{type:"text",class:"form-control","onUpdate:modelValue":o[9]||(o[9]=a=>t.href=a)},null,512),[[m,t.href]]),u("div",{class:"input-group-text"},[u("button",{class:"w-24",onClick:s},"\u83B7\u53D6")])])]),_:1}),r(f,{label:"\u5546\u54C1\u6807\u9898",content:"",layout:"small"},{default:i(()=>[d(u("input",{type:"text",class:"form-control","onUpdate:modelValue":o[10]||(o[10]=a=>t.title=a)},null,512),[[m,t.title]])]),_:1}),r(f,{label:"\u63A8\u5E7F\u77ED\u6807\u9898",content:"",layout:"small"},{default:i(()=>[d(u("input",{type:"text",class:"form-control","onUpdate:modelValue":o[11]||(o[11]=a=>t.d_title=a)},null,512),[[m,t.d_title]]),Ct]),_:1}),r(f,{label:"\u539F\u4EF7\u683C",content:"",layout:"small"},{default:i(()=>[d(u("input",{type:"text",class:"form-control","onUpdate:modelValue":o[12]||(o[12]=a=>t.price=a)},null,512),[[m,t.price]])]),_:1}),r(f,{label:"\u56FE\u7247",content:"",layout:"small"},{default:i(()=>[d(u("input",{type:"text",class:"form-control","onUpdate:modelValue":o[13]||(o[13]=a=>t.pic_url=a),placeholder:"\u4F8B\uFF1Ahttps://img.alicdn.com/imgextra/i1/2454060579/TB2fakMdl0lpuFjSszdXXcdxFXa_!!2454060579.jpg"},null,512),[[m,t.pic_url]]),r(ot,{name:"file",multiple:!0,action:V(N),onChange:e},{default:i(()=>[u("button",kt,[r(et,{class:"w-4 h-4 mr-2"}),G("\u4E0A\u4F20 ")])]),_:1},8,["action"]),V(A)?(g(),y("img",{key:0,class:"w-48 h-48",src:t.pic_url},null,8,Bt)):b("",!0),n.data.pic_urls&&n.data.pic_urls.length>0?(g(),y("div",$t,[Vt,u("ul",Ut,[(g(!0),y(P,null,O(n.data.pic_urls,(a,x)=>(g(),y("li",{key:x,onClick:lt=>v(a),class:"w-48 h-48"},[u("img",{src:a,class:"w-48 h-48"},null,8,jt)],8,At))),128))])])):b("",!0)]),_:1}),r(f,{label:"\u4F18\u60E0\u5238\u8FDE\u63A5",content:"",layout:"small"},{default:i(()=>[d(u("input",{type:"text",class:"form-control","onUpdate:modelValue":o[14]||(o[14]=a=>t.coupon_url=a)},null,512),[[m,t.coupon_url]]),qt]),_:1}),r(f,{label:"\u5206\u7C7B",content:"",layout:"small"},{default:i(()=>[d(u("select",{class:"form-select","onUpdate:modelValue":o[15]||(o[15]=a=>t.cid1=a)},[Pt,(g(!0),y(P,null,O(n.data.cats,(a,x)=>(g(),y("option",{key:x,value:a.c_id},h(a.short_name),9,Lt))),128))],512),[[Q,t.cid1]])]),_:1}),r(f,{label:"\u5F00\u59CB\u65F6\u95F4",content:"",layout:"small"},{default:i(()=>[r(z,{modelValue:t.create_time,"onUpdate:modelValue":o[16]||(o[16]=a=>t.create_time=a),options:{autoApply:!1,showWeekNumbers:!0,format:"YYYY-MM-DD",dropdowns:{minYear:1990,maxYear:null,months:!0,years:!0}},class:"block w-56 form-control"},null,8,["modelValue"])]),_:1}),r(f,{label:"\u7ED3\u675F\u65F6\u95F4",content:"",layout:"small"},{default:i(()=>[r(z,{modelValue:t.end_time,"onUpdate:modelValue":o[17]||(o[17]=a=>t.end_time=a),options:{autoApply:!1,showWeekNumbers:!0,format:"YYYY-MM-DD",dropdowns:{minYear:1990,maxYear:null,months:!0,years:!0}},class:"block w-56 form-control"},null,8,["modelValue"])]),_:1}),r(f,{label:"\u5FAE\u4FE1\u7FA4\u4E13\u7528\u56FE",content:"",layout:"small"},{default:i(()=>[d(u("input",{type:"text",class:"form-control","onUpdate:modelValue":o[18]||(o[18]=a=>t.qq_pic_url=a)},null,512),[[m,t.qq_pic_url]])]),_:1}),r(f,{label:"\u5BFC\u8D2D\u6587\u6848",content:"",layout:"small"},{default:i(()=>[d(u("textarea",{class:"form-control","onUpdate:modelValue":o[19]||(o[19]=a=>t.comment=a),rows:4,placeholder:"\u8BF7\u8F93\u516520-100\u5B57\u5BFC\u8D2D\u6587\u6848\u4ECB\u7ECD"},null,512),[[m,t.comment]]),n.data.wen_items&&n.data.wen_items.length>0?(g(),y("div",Yt,[St,u("ul",Mt,[(g(!0),y(P,null,O(n.data.wen_items,(a,x)=>(g(),y("li",{key:x,onClick:lt=>T(a)},h(x+1)+"."+h(a.content),9,Nt))),128))])])):b("",!0)]),_:1}),r(f,{label:"\u89C6\u9891\u6587\u4EF6",content:"",layout:"small"},{default:i(()=>[d(u("input",{type:"text",class:"form-control","onUpdate:modelValue":o[20]||(o[20]=a=>t.qq_video_url=a)},null,512),[[m,t.qq_video_url]])]),_:1})],64)):b("",!0)]),_:1})]),_:1},8,["spinning"])]),_:1},8,["visible","confirm-loading"])}}}),Gt={class:"box flex p-2 py-5"},Ot={class:"flex flex-1 flex-col items-center justify-center gap-y-2"},Rt=u("span",null,"\u8D26\u53F7\u4F59\u989D",-1),zt={class:"flex flex-1 flex-col items-center justify-center gap-y-2"},Wt=u("span",null,"\u9501\u5B9A\u91D1\u989D",-1),Xt={class:"flex flex-1 flex-col items-center justify-center gap-y-2"},Ht=u("span",null,"\u6D3B\u52A8\u5546\u54C1",-1),Zt=u("option",{value:""},"\u5168\u90E8",-1),Jt={value:"2"},Kt={value:"1"},Qt={value:"0"},te={value:"-1"},ee={value:"-2"},le=Z({__name:"miandan",setup(tt){const U=J(),M=K(()=>`${U.urlPrefix}${U.apiUrl}${vt.list}`),R=dt({}),N=[{formatter:"responsiveCollapse",width:40,minWidth:30,hozAlign:"center",resizable:!0,headerSort:!1},{title:"\u4E3B\u56FE",width:50,field:"pic_url",formatter(e){return _(`<a target="_blank" href="${e.getData().item_url}">
          <img src="${e.getData().pic_url}" />
        </a>`)[0]}},{title:"\u77ED\u6807\u9898",className:"common",field:"title",formatter(e){return _(`<a target="_blank" href="https://www.haowulm.com/?coupon=1&q=${encodeURIComponent(e.getData().item_url)}">
          ${e.getData().title}
        </a>`)[0]}},{title:"\u539F\u4EF7/\u5238\u540E\u4EF7	",width:120,field:"price",sorter:!0,formatter(e){return _(`<a target="_blank" href="${e.getData().item_url}">
          ${e.getData().price}
        </a>`)[0]}},{title:"\u4F63\u91D1\u6BD4\u4F8B",width:80,field:"coupon.commission_rate",formatter(e){return e.getData().coupon.commission_rate+"%"}},{title:"\u4F18\u60E0\u5238",width:80,field:"money",formatter(e){return _(`<a target="_blank" href=${e.getData().coupon_url}">
        \u67E5\u770B
        </a>`)[0]}},{title:"\u8D77\u6B62\u65E5\u671F",field:"",width:100,formatter(e){return _(`
        ${e.getData().create_time?`<span>${H(e.getData().create_time)}</span>`:""}
        ${e.getData().end_time?`<p>${H(e.getData().end_time)}</p>`:""}
        `)[0]}},{title:"\u9500\u91CF",width:50,field:"volume"},{title:"\u72B6\u6001",width:80,field:"",sorter:!0,formatter(e){return e.getData().status===0?"\u8349\u7A3F":e.getData().status===1?"\u5F85\u5BA1\u6838":e.getData().status===2?"\u4E0A\u67B6":e.getData().status===-1?"\u5DF2\u62D2\u7EDD":e.getData().status===-2?"\u5DF2\u4E0B\u67B6":""}},{title:"\u680F\u76EE",field:"category.short_name",width:60},{title:"\u5E97\u94FA",field:"user_type",width:80,formatter(e){return e.getData().user_type==="B"?"\u5929\u732B":"\u6DD8\u5B9D"}},{title:"\u66F4\u65B0\u65F6\u95F4",width:160,field:"updated_at",formatter(e){return ct(e.getData().created_at,"YY-MM-DD HH:mm")}},{title:"\u64CD\u4F5C",field:"action",width:120,hozAlign:"center",formatter(e){if(e.getData().status===-2){const s=_('<a class="flex items-center" href="javascript:;">\u6362\u5238</a>');return _(s).on("click",function(p){k(e.getData())}),s[0]}else if(e.getData().status===-1){const s=_('<a class="flex items-center" href="javascript:;">\u6362\u5238</a>');return _(s).on("click",function(p){k(e.getData())}),s[0]}else if(e.getData().status===0){const s=_('<a class="flex items-center" href="javascript:;">\u7F16\u8F91</a>');return _(s).on("click",function(p){k(e.getData())}),s[0]}else if(e.getData().status===1){const s=_('<a class="flex items-center" href="javascript:;">\u64A4\u9500\u5BA1\u6838</a>');return _(s).on("click",function(p){A(e.getData(),0)}),s[0]}else if(e.getData().status===2){const s=_('<a class="flex items-center" href="javascript:;">\u4E0B\u67B6</a>');return _(s).on("click",function(p){A(e.getData(),-2)}),s[0]}return""}}],t=Y({num_iid:"",status:"",url:""}),c=Y({report:{status0:0,status1:0,status2:0,status01:0,status02:0},userData:{points:0,points_total:0,pub_goods:0}});mt(()=>{B()});const n=X(),A=(e,s)=>{bt({id:e.id,status:s}).then(p=>{const{code:E}=p||{};E===0?S.success(p.message):S.error(p.message),F(!1)})},k=e=>{e.item_url&&(e.href=e.item_url),n.value.edit(e)},w=X(),F=e=>{w.value.reload(e),B()},B=()=>{yt({}).then(e=>{e.data.item&&(c.report.status0=e.data.item[0]?e.data.item[0]:0,c.report.status1=e.data.item[1]?e.data.item[1]:0,c.report.status2=e.data.item[2]?e.data.item[2]:0,c.report.status01=e.data.item[-1]?e.data.item[-1]:0,c.report.status02=e.data.item[-2]?e.data.item[-2]:0)})};return(e,s)=>{const p=D("h-form-item"),E=D("h-form"),I=pt,T=D("h-card");return g(),$(T,{bordered:!1,title:"\u514D\u5355\u5546\u54C1"},{header:i(()=>[u("button",{class:"btn btn-primary mr-2 shadow-md",onClick:s[0]||(s[0]=v=>n.value.edit({}))},"\u53D1\u5E03\u514D\u5355\u5546\u54C1 ")]),extra:i(()=>[u("div",Gt,[u("div",Ot,[Rt,u("span",null,h(c.userData.points),1)]),u("div",zt,[Wt,u("span",null,h(c.userData.points_total),1)]),u("div",Xt,[Ht,u("span",null,h(c.userData.pub_goods),1)])])]),default:i(()=>[r(I,{ref_key:"tableRef",ref:w,columns:N,ajaxUrl:V(M),config:V(R),queryParam:t},{search:i(()=>[r(E,{layout:"inline"},{default:i(()=>[r(p,{label:"\u72B6\u6001",content:"",layout:"inline"},{default:i(()=>[d(u("select",{"onUpdate:modelValue":s[1]||(s[1]=v=>t.status=v),class:"form-select mt-2 w-full sm:mt-0 sm:w-auto",onChange:F},[Zt,u("option",Jt,"\u901A\u8FC7 ("+h(c.report.status2)+")",1),u("option",Kt,"\u5BA1\u6838\u4E2D ("+h(c.report.status1)+")",1),u("option",Qt,"\u8349\u7A3F ("+h(c.report.status0)+")",1),u("option",te,"\u62D2\u7EDD ("+h(c.report.status01)+")",1),u("option",ee,"\u4E0B\u67B6 ("+h(c.report.status02)+")",1)],544),[[Q,t.status]])]),_:1}),r(p,{label:"\u5546\u54C1\u7F16\u53F7",content:"",layout:"inline"},{default:i(()=>[d(u("input",{"onUpdate:modelValue":s[2]||(s[2]=v=>t.num_iid=v),type:"text",class:"form-control mt-2 sm:mt-0 sm:w-40 2xl:w-full"},null,512),[[m,t.num_iid]])]),_:1}),r(p,{label:"\u5546\u54C1\u5730\u5740",content:"",layout:"inline"},{default:i(()=>[d(u("input",{"onUpdate:modelValue":s[3]||(s[3]=v=>t.url=v),type:"text",class:"form-control mt-2 sm:mt-0 sm:w-40 2xl:w-full"},null,512),[[m,t.url]])]),_:1}),u("div",{class:"mt-2 xl:mt-0"},[u("button",{type:"button",class:"btn btn-primary w-full sm:w-16",onClick:F}," \u67E5\u8BE2 ")])]),_:1})]),_:1},8,["ajaxUrl","config","queryParam"]),r(Tt,{ref_key:"modal",ref:n,onOk:s[4]||(s[4]=v=>F(!1))},null,512)]),_:1})}}});export{le as default};
