import{h as J,Y as K,j as Y,D as Q,E as it,k as rt,t as dt,ak as j,a as p,b as L,w as r,l as u,n as R,e as F,p as i,c as v,x as f,y as _,F as $,u as A,I as G,a0 as tt,m as b,v as B,q as S,s as h,Z as mt,o as ct,C as H,d as c}from"./index.9c437169.js";import{u as pt,f as ft,a as _t,b as gt,c as ht,g as vt,d as Dt,e as bt}from"./goods.1eb4fb89.js";import{g as Ft,i as wt}from"./common.3129e343.js";import{b as Z,a as M,f as yt}from"./dateUtil.cd140771.js";import{p as P}from"./pick.40b27695.js";const Et={class:"input-group"},Ct={class:"input-group"},Bt=u("div",{class:"form-help"},"\u8FD8\u53EF\u4EE5\u8F93\u5165 16 \u4E2A\u5B57",-1),kt={class:"w-32 mt-1 mb-2 mr-2 btn btn-outline-success btn-sm"},xt=["src"],Vt={key:1,class:"py-2"},$t=u("p",null,"\u4E3B\u56FE\u53C2\u8003",-1),At={class:"flex flex-row flex-wrap gap-x-1 gap-y-1"},Ut=["onClick"],qt=["src"],jt=u("div",{class:"form-help"},"\u4F18\u60E0\u5238\u5EFA\u8BAE\u65F6\u95F47\u5929\u5DE6\u53F3",-1),Pt=u("option",{value:0},"--\u9009\u62E9--",-1),Lt=["value"],Yt={key:0},St=u("p",null,"\u5907\u9009\u6587\u6848",-1),Mt={class:"flex flex-col gap-y-3"},Nt=["onClick"],Tt=["className"],Ot=J({__name:"goods",emits:["ok"],setup(et,{expose:U,emit:N}){const T=K().uploadUrl,a=Y({href:"",qq_video_url:"",coupon_url:"",money:0,id:0,item_id:"",seller_id:"",ori_price:0,user_type:0,volume:0,condition:0,title:"",price:0,qq_pic_url:"",comment:"",cid1:0,d_title:"",pic_url:"",create_time:"",end_time:""}),g={},o=Y({visible:!1,confirmLoading:!1,data:{hrefPreview:"",contentPreview:"",step:0,cats:[],wen_items:[],pic_urls:[]}}),q=Q(()=>!wt(a.pic_url));it(()=>{k()});const k=()=>{Ft({}).then(l=>{l.data.items&&(o.data.cats=l.data.items)})},w=rt(g,dt(a)),y=l=>{o.data.step=0,o.data.contentPreview="",o.data.hrefPreview="",o.visible=!0,B(()=>{Object.assign(a,{href:"",qq_video_url:"",coupon_url:"",money:0,id:0,item_id:"",seller_id:"",ori_price:0,user_type:0,volume:0,condition:0,title:"",price:0,qq_pic_url:"",comment:"",cid1:0,d_title:"",pic_url:"",create_time:"",end_time:""}),o.data.pic_urls=[],o.data.wen_items=[],l.id&&(o.data.step=1);const e=P(l,["id","cid1","coupon_url","href","item_id","title","d_title","price","pic_url","seller_id","ori_price","user_type","volume","comment","create_time","end_time","money","condition"]);Object.assign(a,e),m()})},x=l=>{if(o.confirmLoading=!0,w.value.$touch(),w.value.$invalid)w.value.$errors,o.confirmLoading=!1;else{let e=A(a);e.create_time&&(e=Object.assign(e,{create_time:Z(e.create_time)})),e.end_time&&(e=Object.assign(e,{end_time:Z(e.end_time)})),pt(Object.assign({},e,{submitStatus:l})).then(d=>{d.code===0&&(l===1?S.success("\u63D0\u4EA4\u6210\u529F"):S.success("\u4FDD\u5B58\u6210\u529F"),N("ok",e),o.visible=!1),o.confirmLoading=!1})}},t=l=>{a.pic_url=l.data.item.img},s=()=>{ft({href:a.href}).then(l=>{l.data.goods&&(B(()=>{Object.assign(a,P(l.data.goods,["id","cid1","coupon_url","href","item_id","title","d_title","price","pic_url","seller_id","ori_price","user_type","volume","comment"]))}),o.data.wen_items=l.data.goods.wen_items||[],o.data.pic_urls=l.data.goods.pic_urls||[]),o.confirmLoading=!1})},m=()=>{_t({href:a.href}).then(l=>{l.data.goods&&(o.data.wen_items=l.data.goods.wen_items||[],o.data.pic_urls=l.data.goods.pic_urls||[])})},E=()=>{ht({href:a.href,coupon_url:a.coupon_url}).then(l=>{l.data.coupon&&B(()=>{const e=P(l.data.coupon,["money","condition"]);Object.assign(a,e),a.create_time=M(l.data.coupon.create_time),a.end_time=M(l.data.coupon.end_time)})})},O=()=>{o.visible=!1},I=l=>{B(()=>{Object.assign(a,{comment:l.content})})},D=l=>{B(()=>{a.pic_url=l})},V=()=>{gt({href:o.data.hrefPreview,content:o.data.contentPreview}).then(l=>{l.data.item&&B(()=>{const e=P(l.data.item,["href","coupon_url"]);Object.assign(a,e),o.data.step=1,s(),E()})})};return j(()=>a.href,(l,e)=>{m()},{immediate:!0}),j(()=>a.coupon_url,(l,e)=>{E()},{immediate:!0}),j(()=>o.data.hrefPreview,(l,e)=>{V()},{immediate:!0}),j(()=>o.data.contentPreview,(l,e)=>{V()},{immediate:!0}),U({edit:y}),(l,e)=>{const d=h("h-form-item"),at=h("UploadIcon"),ot=h("h-upload"),W=h("Litepicker"),ut=h("h-form"),nt=h("h-spin"),X=h("LoadingIcon"),lt=h("h-modal");return p(),L(lt,{title:"\u53D1\u5E03\u5546\u54C1",size:"modal-xl",visible:o.visible,"confirm-loading":o.confirmLoading,onCancel:O},{footer:r(()=>[u("div",{className:o.data.step===0?"hidden":""},[u("button",{class:"w-24 mb-2 mr-1 btn btn-primary",onClick:e[14]||(e[14]=n=>x(1))},[R(" \u63D0\u4EA4\u5BA1\u6838 "),o.confirmLoading?(p(),L(X,{key:0,icon:"oval",color:"white",class:"w-4 h-4 ml-2"})):F("",!0)]),u("button",{class:"w-24 mb-2 mr-1 btn btn-primary",onClick:e[15]||(e[15]=n=>x(0))},[R("\u4FDD\u5B58\u8349\u7A3F "),o.confirmLoading?(p(),L(X,{key:0,icon:"oval",color:"white",class:"w-4 ml-2"})):F("",!0)])],8,Tt)]),default:r(()=>[i(nt,{spinning:o.confirmLoading},{default:r(()=>[i(ut,{layout:"small"},{default:r(()=>[o.data.step==0?(p(),v($,{key:0},[i(d,{label:"\u5546\u54C1\u94FE\u63A5",content:"",layout:"small"},{default:r(()=>[u("div",Et,[f(u("input",{type:"text",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=n=>o.data.hrefPreview=n),onChange:V},null,544),[[_,o.data.hrefPreview]]),u("div",{class:"input-group-text"},[u("button",{class:"w-24",onClick:V},"\u83B7\u53D6")])])]),_:1}),i(d,{label:"\u5546\u54C1\u6587\u6848",content:"",layout:"small"},{default:r(()=>[f(u("textarea",{class:"form-control","onUpdate:modelValue":e[1]||(e[1]=n=>o.data.contentPreview=n),rows:4,placeholder:"\u8BF7\u5728\u6B64\u7C98\u8D34\u63A8\u5E7F\u6587\u6848\uFF0C\u672C\u529F\u80FD\u53EF\u8BC6\u522B\u5927\u591A\u7B26\u5408\u89C4\u5219\u7684\u6587\u6848",onChange:V},null,544),[[_,o.data.contentPreview]])]),_:1})],64)):F("",!0),o.data.step!==0?(p(),v($,{key:1},[i(d,{label:"\u5546\u54C1\u5730\u5740",content:"",layout:"small"},{default:r(()=>[u("div",Ct,[f(u("input",{type:"text",class:"form-control","onUpdate:modelValue":e[2]||(e[2]=n=>a.href=n)},null,512),[[_,a.href]]),u("div",{class:"input-group-text"},[u("button",{class:"w-24",onClick:s},"\u83B7\u53D6")])])]),_:1}),i(d,{label:"\u5546\u54C1\u6807\u9898",content:"",layout:"small"},{default:r(()=>[f(u("input",{type:"text",class:"form-control","onUpdate:modelValue":e[3]||(e[3]=n=>a.title=n)},null,512),[[_,a.title]])]),_:1}),i(d,{label:"\u63A8\u5E7F\u77ED\u6807\u9898",content:"",layout:"small"},{default:r(()=>[f(u("input",{type:"text",class:"form-control","onUpdate:modelValue":e[4]||(e[4]=n=>a.d_title=n)},null,512),[[_,a.d_title]]),Bt]),_:1}),i(d,{label:"\u539F\u4EF7\u683C",content:"",layout:"small"},{default:r(()=>[f(u("input",{type:"text",class:"form-control","onUpdate:modelValue":e[5]||(e[5]=n=>a.price=n)},null,512),[[_,a.price]])]),_:1}),i(d,{label:"\u56FE\u7247",content:"",layout:"small"},{default:r(()=>[f(u("input",{type:"text",class:"form-control","onUpdate:modelValue":e[6]||(e[6]=n=>a.pic_url=n),placeholder:"\u4F8B\uFF1Ahttps://img.alicdn.com/imgextra/i1/2454060579/TB2fakMdl0lpuFjSszdXXcdxFXa_!!2454060579.jpg"},null,512),[[_,a.pic_url]]),i(ot,{name:"file",multiple:!0,action:A(T),onChange:t},{default:r(()=>[u("button",kt,[i(at,{class:"w-4 h-4 mr-2"}),R("\u4E0A\u4F20 ")])]),_:1},8,["action"]),A(q)?(p(),v("img",{key:0,class:"w-48 h-48",src:a.pic_url},null,8,xt)):F("",!0),o.data.pic_urls&&o.data.pic_urls.length>0?(p(),v("div",Vt,[$t,u("ul",At,[(p(!0),v($,null,G(o.data.pic_urls,(n,C)=>(p(),v("li",{key:C,onClick:st=>D(n),class:"p-1 border h-36 w-36 hover:border-green-600"},[u("img",{src:n},null,8,qt)],8,Ut))),128))])])):F("",!0)]),_:1}),i(d,{label:"\u4F18\u60E0\u5238\u8FDE\u63A5",content:"",layout:"small"},{default:r(()=>[f(u("input",{type:"text",class:"form-control","onUpdate:modelValue":e[7]||(e[7]=n=>a.coupon_url=n)},null,512),[[_,a.coupon_url]]),jt]),_:1}),i(d,{label:"\u5206\u7C7B",content:"",layout:"small"},{default:r(()=>[f(u("select",{class:"form-select","onUpdate:modelValue":e[8]||(e[8]=n=>a.cid1=n)},[Pt,(p(!0),v($,null,G(o.data.cats,(n,C)=>(p(),v("option",{key:C,value:n.c_id},b(n.short_name),9,Lt))),128))],512),[[tt,a.cid1]])]),_:1}),i(d,{label:"\u5F00\u59CB\u65F6\u95F4",content:"",layout:"small"},{default:r(()=>[i(W,{modelValue:a.create_time,"onUpdate:modelValue":e[9]||(e[9]=n=>a.create_time=n),options:{autoApply:!1,showWeekNumbers:!0,format:"YYYY-MM-DD",dropdowns:{minYear:1990,maxYear:null,months:!0,years:!0}},class:"block w-56 form-control"},null,8,["modelValue"])]),_:1}),i(d,{label:"\u7ED3\u675F\u65F6\u95F4",content:"",layout:"small"},{default:r(()=>[i(W,{modelValue:a.end_time,"onUpdate:modelValue":e[10]||(e[10]=n=>a.end_time=n),options:{autoApply:!1,showWeekNumbers:!0,format:"YYYY-MM-DD",dropdowns:{minYear:1990,maxYear:null,months:!0,years:!0}},class:"block w-56 form-control"},null,8,["modelValue"])]),_:1}),i(d,{label:"\u5FAE\u4FE1\u7FA4\u4E13\u7528\u56FE",content:"",layout:"small"},{default:r(()=>[f(u("input",{type:"text",class:"form-control","onUpdate:modelValue":e[11]||(e[11]=n=>a.qq_pic_url=n)},null,512),[[_,a.qq_pic_url]])]),_:1}),i(d,{label:"\u5BFC\u8D2D\u6587\u6848",content:"",layout:"small"},{default:r(()=>[f(u("textarea",{class:"form-control","onUpdate:modelValue":e[12]||(e[12]=n=>a.comment=n),rows:4,placeholder:"\u8BF7\u8F93\u516520-100\u5B57\u5BFC\u8D2D\u6587\u6848\u4ECB\u7ECD"},null,512),[[_,a.comment]]),o.data.wen_items&&o.data.wen_items.length>0?(p(),v("div",Yt,[St,u("ul",Mt,[(p(!0),v($,null,G(o.data.wen_items,(n,C)=>(p(),v("li",{key:C,onClick:st=>I(n)},b(C+1)+"."+b(n.content),9,Nt))),128))])])):F("",!0)]),_:1}),i(d,{label:"\u89C6\u9891\u6587\u4EF6",content:"",layout:"small"},{default:r(()=>[f(u("input",{type:"text",class:"form-control","onUpdate:modelValue":e[13]||(e[13]=n=>a.qq_video_url=n)},null,512),[[_,a.qq_video_url]])]),_:1})],64)):F("",!0)]),_:1})]),_:1},8,["spinning"])]),_:1},8,["visible","confirm-loading"])}}}),It=u("option",{value:""},"\u5168\u90E8",-1),Rt={value:"2"},Gt={value:"1"},zt={value:"0"},Wt={value:"-1"},Xt={value:"-2"},te=J({__name:"goods",setup(et){const U=K(),N=Q(()=>`${U.urlPrefix}${U.apiUrl}${Dt.list}`),z=mt({}),T=[{formatter:"responsiveCollapse",width:40,minWidth:30,hozAlign:"center",resizable:!0,headerSort:!1},{title:"\u4E3B\u56FE",width:50,field:"pic_url",formatter(t){return c(`<a target="_blank" href="${t.getData().item_url}">
          <img src="${t.getData().pic_url}" />
        </a>`)[0]}},{title:"\u77ED\u6807\u9898",className:"common",field:"title",formatter(t){return c(`<a target="_blank" href="https://www.haowulm.com/?coupon=1&q=${encodeURIComponent(t.getData().item_url)}">
          ${t.getData().title}
        </a>`)[0]}},{title:"\u539F\u4EF7/\u5238\u540E\u4EF7	",width:120,field:"price",sorter:!0,formatter(t){return c(`<a target="_blank" href="${t.getData().item_url}">
          ${t.getData().price}
        </a>`)[0]}},{title:"\u4F63\u91D1\u6BD4\u4F8B",width:80,field:"coupon.commission_rate",formatter(t){return t.getData().coupon.commission_rate+"%"}},{title:"\u4F18\u60E0\u5238",width:80,field:"money",formatter(t){return c(`<a target="_blank" href="${t.getData().coupon_url}">
        \u67E5\u770B
        </a>`)[0]}},{title:"\u8D77\u6B62\u65E5\u671F",field:"",width:100,formatter(t){return c(`
        ${t.getData().create_time?`<span>${M(t.getData().create_time)}</span>`:""}
        ${t.getData().end_time?`<p>${M(t.getData().end_time)}</p>`:""}
        `)[0]}},{title:"\u9500\u91CF",width:50,field:"volume"},{title:"\u72B6\u6001",width:80,field:"",sorter:!0,formatter(t){return t.getData().status===0?"\u8349\u7A3F":t.getData().status===1?"\u5F85\u5BA1\u6838":t.getData().status===2?"\u4E0A\u67B6":t.getData().status===-1?"\u5DF2\u62D2\u7EDD":t.getData().status===-2?"\u5DF2\u4E0B\u67B6":""}},{title:"\u680F\u76EE",field:"category.short_name",width:60},{title:"\u5E97\u94FA",field:"user_type",width:80,formatter(t){return t.getData().user_type==="B"?"\u5929\u732B":"\u6DD8\u5B9D"}},{title:"\u66F4\u65B0\u65F6\u95F4",width:160,field:"updated_at",formatter(t){return yt(t.getData().created_at,"YY-MM-DD HH:mm")}},{title:"\u64CD\u4F5C",field:"action",width:120,hozAlign:"center",formatter(t){if(t.getData().status===-2){const s=c('<a class="flex items-center" href="javascript:;">\u6362\u5238</a>');return c(s).on("click",function(m){k(t.getData())}),s[0]}else if(t.getData().status===-1){const s=c('<a class="flex items-center" href="javascript:;">\u6362\u5238</a>');return c(s).on("click",function(m){k(t.getData())}),s[0]}else if(t.getData().status===0){const s=c('<a class="flex items-center" href="javascript:;">\u7F16\u8F91</a>');return c(s).on("click",function(m){k(t.getData())}),s[0]}else if(t.getData().status===1){const s=c('<a class="flex items-center" href="javascript:;">\u64A4\u9500\u5BA1\u6838</a>');return c(s).on("click",function(m){q(t.getData(),0)}),s[0]}else if(t.getData().status===2){const s=c('<a class="flex items-center" href="javascript:;">\u4E0B\u67B6</a>');return c(s).on("click",function(m){q(t.getData(),-2)}),s[0]}return""}}],a=Y({item_id:"",status:"",url:""}),g=Y({report:{status0:0,status1:0,status2:0,status01:0,status02:0}});ct(()=>{x()});const o=H(),q=(t,s)=>{bt({id:t.id,status:s}).then(m=>{const{code:E}=m||{};E===0?S.success(m.message):S.error(m.message),y(!1)})},k=t=>{t.item_url&&(t.href=t.item_url),o.value.edit(t)},w=H(),y=t=>{w.value.reload(t),x()},x=()=>{vt({}).then(t=>{t.data.item&&(g.report.status0=t.data.item[0]?t.data.item[0]:0,g.report.status1=t.data.item[1]?t.data.item[1]:0,g.report.status2=t.data.item[2]?t.data.item[2]:0,g.report.status01=t.data.item[-1]?t.data.item[-1]:0,g.report.status02=t.data.item[-2]?t.data.item[-2]:0)})};return(t,s)=>{const m=h("h-form-item"),E=h("h-form"),O=h("Tablepage"),I=h("h-card");return p(),L(I,{bordered:!1,title:"\u5546\u54C1\u53D1\u5E03"},{header:r(()=>[u("button",{class:"mr-2 shadow-md btn btn-primary",onClick:s[0]||(s[0]=D=>o.value.edit({}))},"\u53D1\u5E03\u5546\u54C1 ")]),default:r(()=>[i(O,{ref_key:"tableRef",ref:w,columns:T,ajaxUrl:A(N),config:A(z),queryParam:a},{search:r(()=>[i(E,{layout:"inline"},{default:r(()=>[i(m,{label:"\u72B6\u6001",content:"",layout:"inline"},{default:r(()=>[f(u("select",{"onUpdate:modelValue":s[1]||(s[1]=D=>a.status=D),class:"w-full mt-2 form-select sm:mt-0 sm:w-auto",onChange:y},[It,u("option",Rt,"\u901A\u8FC7 ("+b(g.report.status2)+")",1),u("option",Gt,"\u5BA1\u6838\u4E2D ("+b(g.report.status1)+")",1),u("option",zt,"\u8349\u7A3F ("+b(g.report.status0)+")",1),u("option",Wt,"\u62D2\u7EDD ("+b(g.report.status01)+")",1),u("option",Xt,"\u4E0B\u67B6 ("+b(g.report.status02)+")",1)],544),[[tt,a.status]])]),_:1}),i(m,{label:"\u5546\u54C1\u7F16\u53F7",content:"",layout:"inline"},{default:r(()=>[f(u("input",{"onUpdate:modelValue":s[2]||(s[2]=D=>a.item_id=D),type:"text",class:"mt-2 form-control sm:mt-0 sm:w-40 2xl:w-full"},null,512),[[_,a.item_id]])]),_:1}),i(m,{label:"\u5546\u54C1\u5730\u5740",content:"",layout:"inline"},{default:r(()=>[f(u("input",{"onUpdate:modelValue":s[3]||(s[3]=D=>a.url=D),type:"text",class:"mt-2 form-control sm:mt-0 sm:w-40 2xl:w-full"},null,512),[[_,a.url]])]),_:1}),u("div",{class:"mt-2 xl:mt-0"},[u("button",{type:"button",class:"w-full btn btn-primary sm:w-16",onClick:y}," \u67E5\u8BE2 ")])]),_:1})]),_:1},8,["ajaxUrl","config","queryParam"]),i(Ot,{ref_key:"modal",ref:o,onOk:s[4]||(s[4]=D=>y(!1))},null,512)]),_:1})}}});export{te as default};
