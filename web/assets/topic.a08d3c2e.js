import{r as q,h as S,Z as G,j as E,k as N,t as W,l as m,a as y,b as A,w as t,m as i,p as T,e as z,q as o,x,y as C,u as U,v as M,s as P,_ as O,C as V,ar as ne,c as j,F as Z,L as ae,G as H,$ as J,d as B,a2 as K}from"./index.e4720a69.js";import{p as R}from"./pick.6e93943e.js";import{f as le}from"./goods.264dcbc6.js";const Y={getItems:"/api/user/market/topic/list",getView:"/api/user/market/topic/view",updateItem:"/api/user/market/topic/update",getItemsGoods:"/api/user/market/topic/topic_items",updateGoods:"/api/user/market/topic/update_goods",updateStatus:"/api/user/market/topic/updateStatus"};function se(F){return q({url:Y.updateGoods,method:"post",data:F})}function ie(F){return q({url:Y.updateItem,method:"post",data:F})}const re={class:"w-32 mt-1 mb-2 mr-2 btn btn-outline-success btn-sm"},ue=S({__name:"topic",emits:["ok"],setup(F,{expose:D,emit:I}){const a=G().uploadUrl,u=E({id:0,classes:"",name:"",content:"",pic_url:""}),w={},e=E({visible:!1,confirmLoading:!1}),f=()=>{e.visible=!1},v=r=>{u.pic_url=r.data.item.img},_=N(w,W(u)),g=r=>{e.visible=!0,Object.assign(u,{id:0,classes:"",name:"",content:"",pic_url:""}),M(()=>{Object.assign(u,R(r,["id","name","content","pic_url"]))})},c=()=>{if(e.confirmLoading=!0,_.value.$touch(),_.value.$invalid)_.value.$errors,e.confirmLoading=!1;else{const r=U(u);ie(r).then(n=>{const{code:d}=n||{};d===0?P.success("\u4FDD\u5B58\u6210\u529F"):P.error(n.message),e.confirmLoading=!1,I("ok",r),e.visible=!1})}};return D({edit:g}),(r,n)=>{const d=m("h-form-item"),k=m("UploadIcon"),L=m("h-upload"),l=m("h-form"),s=m("LoadingIcon"),h=m("h-modal");return y(),A(h,{title:"\u53D1\u5E03\u4E13\u9898",size:"modal-lg",visible:e.visible,"confirm-loading":e.confirmLoading,onCancel:f},{footer:t(()=>[i("button",{class:"w-24 mb-2 mr-1 btn btn-primary",onClick:n[3]||(n[3]=p=>c())},[T(" \u4FDD\u5B58 "),e.confirmLoading?(y(),A(s,{key:0,icon:"oval",color:"white",class:"w-4 h-4 ml-2"})):z("v-if",!0)])]),default:t(()=>[o(l,{layout:"small"},{default:t(()=>[o(d,{label:"\u4E13\u9898\u540D\u79F0",content:"",layout:"small"},{default:t(()=>[x(i("input",{type:"text",class:"form-control","onUpdate:modelValue":n[0]||(n[0]=p=>u.name=p)},null,512),[[C,u.name]])]),_:1}),o(d,{label:"\u5185\u5BB9",content:"",layout:"small"},{default:t(()=>[x(i("textarea",{class:"form-control","onUpdate:modelValue":n[1]||(n[1]=p=>u.content=p),rows:4},null,512),[[C,u.content]])]),_:1}),o(d,{label:"\u56FE\u7247",content:"",layout:"small"},{default:t(()=>[x(i("input",{type:"text",class:"form-control","onUpdate:modelValue":n[2]||(n[2]=p=>u.pic_url=p),placeholder:""},null,512),[[C,u.pic_url]]),o(L,{name:"file",multiple:!0,action:U(a),onChange:v},{default:t(()=>[i("button",re,[o(k,{class:"w-4 h-4 mr-2"}),T("\u4E0A\u4F20 ")])]),_:1},8,["action"])]),_:1})]),_:1})]),_:1},8,["visible","confirm-loading"])}}}),ce=O(ue,[["__file","/Users/wu./Documents/os/web/www/web/src/views/user/market/topic/modal/topic.vue"]]),me={class:"input-group"},de={class:"w-32 mt-1 mb-2 mr-2 btn btn-outline-success btn-sm"},pe=["src"],fe={key:1,class:"pics"},_e=i("p",null,"\u4E3B\u56FE\u53C2\u8003",-1),ge=["onClick"],be=["src"],he=S({__name:"goods",setup(F,{expose:D}){const $=G().uploadUrl,a=E({href:"",pic_url:"",id:0,item_id:"",title:"",price:0}),u={},w=E({topic_id:0}),e=E({visible:!1,confirmLoading:!1,data:{previewImg:"",pic_urls:[],wen_items:[]}}),f=()=>{e.visible=!1},v=l=>{a.pic_url=l.data.item.img},_=V(),g=N(u,W(a)),c=l=>{e.visible=!0,M(()=>{Object.assign(a,{href:"",pic_url:"",id:0,item_id:"",title:"",price:0}),w.topic_id=l.id,_.value.reload(!0)})},r=l=>{M(()=>{Object.assign(a,{href:"",pic_url:"",id:0,item_id:"",title:"",price:0});const s=R(l,["id","href","item_id","title","price","pic_url"]);Object.assign(a,s),e.data.pic_urls=[],k()})},n=()=>{if(e.confirmLoading=!0,g.value.$touch(),g.value.$invalid)g.value.$errors,e.confirmLoading=!1;else{const l=U(a);se(Object.assign(l,{topic_id:w.topic_id})).then(s=>{const{code:h}=s||{};h===0?P.success("\u4FDD\u5B58\u6210\u529F"):P.error(s.message),e.confirmLoading=!1,_.value.reload(!0),r({})})}},d=()=>{le({href:a.href}).then(l=>{l.data.goods&&(M(()=>{Object.assign(a,R(l.data.goods,["href","item_id","title","price","pic_url"]))}),e.data.wen_items=l.data.goods.wen_items||[],e.data.pic_urls=l.data.goods.pic_urls||[]),e.confirmLoading=!1})},k=()=>{!a.href||fetchGoodsInfoEx({href:a.href}).then(l=>{l.data.goods&&(e.data.pic_urls=l.data.goods.pic_urls||[])})},L=l=>{M(()=>{a.pic_url=l}),e.data.previewImg=l};return ne(()=>a.href,(l,s)=>{k()},{immediate:!0}),D({edit:c}),(l,s)=>{const h=m("h-form-item"),p=m("UploadIcon"),Q=m("h-upload"),X=m("h-form"),ee=m("h-spin"),te=m("h-modal");return y(),A(te,{title:"\u4E13\u9898\u5546\u54C1\u7BA1\u7406",size:"modal-xl",visible:e.visible,"confirm-loading":e.confirmLoading,onCancel:f},{footer:t(()=>[i("button",{class:"w-24 mb-2 mr-1 btn btn-primary",onClick:s[4]||(s[4]=b=>n())},"\u4FDD\u5B58")]),default:t(()=>[o(ee,{spinning:e.confirmLoading},{default:t(()=>[o(X,{layout:"small"},{default:t(()=>[o(h,{label:"\u5730\u5740",content:"",layout:"small"},{default:t(()=>[i("div",me,[x(i("input",{type:"text",class:"form-control","onUpdate:modelValue":s[0]||(s[0]=b=>a.href=b)},null,512),[[C,a.href]]),i("div",{class:"input-group-text"},[i("button",{class:"w-24",onClick:d},"\u83B7\u53D6")])])]),_:1}),o(h,{label:"\u6807\u9898",content:"",layout:"small"},{default:t(()=>[x(i("input",{type:"text",class:"form-control","onUpdate:modelValue":s[1]||(s[1]=b=>a.title=b)},null,512),[[C,a.title]])]),_:1}),o(h,{label:"\u539F\u4EF7\u683C",content:"",layout:"small"},{default:t(()=>[x(i("input",{type:"text",class:"form-control","onUpdate:modelValue":s[2]||(s[2]=b=>a.price=b)},null,512),[[C,a.price]])]),_:1}),o(h,{label:"\u56FE\u7247",content:"",layout:"small"},{default:t(()=>[x(i("input",{type:"text",class:"form-control","onUpdate:modelValue":s[3]||(s[3]=b=>a.pic_url=b),placeholder:""},null,512),[[C,a.pic_url]]),o(Q,{name:"file",multiple:!0,action:U($),onChange:v},{default:t(()=>[i("button",de,[o(p,{class:"w-4 h-4 mr-2"}),T("\u4E0A\u4F20 ")])]),_:1},8,["action"]),e.data.previewImg?(y(),j("img",{key:0,class:"previewImg",src:e.data.previewImg},null,8,pe)):z("v-if",!0),e.data.pic_urls&&e.data.pic_urls.length>0?(y(),j("div",fe,[_e,i("ul",null,[(y(!0),j(Z,null,ae(e.data.pic_urls,(b,oe)=>(y(),j("li",{key:oe,onClick:xe=>L(b)},[i("img",{src:b},null,8,be)],8,ge))),128))])])):z("v-if",!0)]),_:1})]),_:1})]),_:1},8,["spinning"])]),_:1},8,["visible","confirm-loading"])}}}),we=O(he,[["__file","/Users/wu./Documents/os/web/www/web/src/views/user/market/topic/modal/goods.vue"]]),ve=S({__name:"items",emits:["ok"],setup(F,{expose:D,emit:I}){const $=G(),a=H(()=>`${$.urlPrefix}${$.apiUrl}${Y.getItemsGoods}`),u=J({}),w=[{formatter:"responsiveCollapse",width:40,minWidth:30,hozAlign:"center",resizable:!0,headerSort:!1},{title:"\u6807\u9898",field:"goods.title",formatter(n){return B(`<a target="_blank" href="${n.getData().item_url}">
          ${n.getData().goods.title}
        </a>`)[0]}},{title:"\u4EF7\u683C",field:"goods.price",width:100},{title:"\u56FE\u7247",field:"pic_url",width:100,formatter(n){return B(`<a target="_blank" href="${n.getData().item_url}">
          <img src="${n.getData().goods.pic_url}" />
        </a>`)[0]}},{title:"\u6240\u5C5E\u4E13\u9898",field:"topic.name",width:100}],e=E({rangePicker:"",name:"",status:0,startTime:"",endTime:"",topic_id:""}),f=E({visible:!1,confirmLoading:!1}),v=V(),_=V(),g=()=>{v.value.reload(!0)},c=()=>{f.visible=!1,I("ok",{})};return D({show:n=>{e.topic_id=n.topic_id,f.visible=!0,g()}}),(n,d)=>{const k=m("h-form-item"),L=m("Litepicker"),l=m("h-form"),s=K,h=m("h-drawer");return y(),j(Z,null,[o(h,{title:"\u4E13\u4EAB\u4EA7\u54C1",size:"modal-xl",visible:f.visible,"confirm-loading":f.confirmLoading,onCancel:c},{header:t(()=>[i("button",{class:"mr-2 shadow-md btn btn-primary",onClick:d[0]||(d[0]=p=>_.value.edit({}))},"\u53D1\u5E03 ")]),default:t(()=>[o(s,{ref_key:"tableRef",ref:v,columns:w,ajaxUrl:U(a),config:U(u),queryParam:e},{search:t(()=>[o(l,{layout:"inline"},{default:t(()=>[o(k,{label:"\u7528\u6237\u540D",content:"",layout:"inline"},{default:t(()=>[x(i("input",{"onUpdate:modelValue":d[1]||(d[1]=p=>e.name=p),type:"text",class:"mt-2 form-control sm:mt-0 sm:w-40 2xl:w-full"},null,512),[[C,e.name]])]),_:1}),o(k,{label:"\u521B\u5EFA\u65F6\u95F4",content:"",layout:"inline"},{default:t(()=>[o(L,{modelValue:e.rangePicker,"onUpdate:modelValue":d[2]||(d[2]=p=>e.rangePicker=p),options:{autoApply:!1,singleMode:!1,numberOfColumns:2,numberOfMonths:2,showWeekNumbers:!0,format:"YYYY-MM-DD",dropdowns:{minYear:1990,maxYear:null,months:!0,years:!0}},class:"mt-2 form-control sm:mt-0 sm:w-56 2xl:w-full"},null,8,["modelValue"])]),_:1}),i("div",{class:"mt-2 xl:mt-0"},[i("button",{type:"button",class:"w-full btn btn-primary sm:w-16",onClick:g}," \u67E5\u8BE2 ")])]),_:1})]),_:1},8,["ajaxUrl","config","queryParam"])]),_:1},8,["visible","confirm-loading"]),o(we,{ref_key:"goodsModal",ref:_,onOk:g},null,512)],64)}}}),ke=O(ve,[["__file","/Users/wu./Documents/os/web/www/web/src/views/user/market/topic/items.vue"]]),ye=S({__name:"topic",setup(F){const D=G(),I=H(()=>`${D.urlPrefix}${D.apiUrl}${Y.getItems}`),$=J({}),a=[{formatter:"responsiveCollapse",width:40,minWidth:30,hozAlign:"center",resizable:!0,headerSort:!1},{title:"\u6807\u9898",field:"name",width:200},{title:"\u5185\u5BB9",field:"content"},{title:"\u56FE\u7247",field:"pic_url",width:100,formatter(c){return B(`<a target="_blank" href="${c.getData().item_url}">
          <img src="${c.getData().pic_url}" />
        </a>`)[0]}},{title:"\u5546\u54C1\u6570\u91CF",field:"count",width:100},{title:"\u5546\u54C1\u7BA1\u7406",hozAlign:"center",field:"",width:120,formatter(c){if(c.getData().status!=1&&c.getData().status!=2){const r=B('<a class="flex items-center text-center" href="javascript:;">\u7BA1\u7406</a>');return B(r).on("click",function(n){_({topic_id:c.getData().id})}),r[0]}return""}},{title:"\u64CD\u4F5C",hozAlign:"center",width:150,field:"",formatter(c){if(c.getData().status!=1&&c.getData().status!=2){const r=B('<a class="flex items-center" href="javascript:;">\u7F16\u8F91</a>');return B(r).on("click",function(n){g(c.getData())}),r[0]}return""}}],u=E({rangePicker:"",name:"",status:0,startTime:"",endTime:""}),w=V(),e=()=>{w.value.reload(!0)},f=V(),v=V(),_=c=>{v.value.show(c)},g=c=>{f.value.edit(c)};return(c,r)=>{const n=m("h-form-item"),d=m("Litepicker"),k=m("h-form"),L=K,l=m("h-card");return y(),A(l,{bordered:!1,title:"\u4E13\u9898"},{header:t(()=>[i("button",{class:"mr-2 shadow-md btn btn-primary",onClick:r[0]||(r[0]=s=>f.value.edit({}))},"\u53D1\u5E03\u4E13\u9898 ")]),default:t(()=>[o(L,{ref_key:"tableRef",ref:w,columns:a,ajaxUrl:U(I),config:U($),queryParam:u},{search:t(()=>[o(k,{layout:"inline"},{default:t(()=>[o(n,{label:"\u7528\u6237\u540D",content:"",layout:"inline"},{default:t(()=>[x(i("input",{"onUpdate:modelValue":r[1]||(r[1]=s=>u.name=s),type:"text",class:"mt-2 form-control sm:mt-0 sm:w-40 2xl:w-full"},null,512),[[C,u.name]])]),_:1}),o(n,{label:"\u521B\u5EFA\u65F6\u95F4",content:"",layout:"inline"},{default:t(()=>[o(d,{modelValue:u.rangePicker,"onUpdate:modelValue":r[2]||(r[2]=s=>u.rangePicker=s),options:{autoApply:!1,singleMode:!1,numberOfColumns:2,numberOfMonths:2,showWeekNumbers:!0,format:"YYYY-MM-DD",dropdowns:{minYear:1990,maxYear:null,months:!0,years:!0}},class:"mt-2 form-control sm:mt-0 sm:w-56 2xl:w-full"},null,8,["modelValue"])]),_:1}),i("div",{class:"mt-2 xl:mt-0"},[i("button",{type:"button",class:"w-full btn btn-primary sm:w-16",onClick:e}," \u67E5\u8BE2 ")])]),_:1})]),_:1},8,["ajaxUrl","config","queryParam"]),o(ce,{ref_key:"modal",ref:f,onOk:e},null,512),o(ke,{ref_key:"itemsModal",ref:v,onOk:e},null,512)]),_:1})}}}),Ue=O(ye,[["__file","/Users/wu./Documents/os/web/www/web/src/views/user/market/topic.vue"]]);export{Ue as default};
