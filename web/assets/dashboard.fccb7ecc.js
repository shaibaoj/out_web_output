import{h as D,Y as q,j as z,D as _,E as S,q as m,b as f,w as u,aB as V,s as r,a as c,c as N,l as t,u as l,e as F,p as s,m as o,n as w}from"./index.add566e0.js";import{g as U,a as $}from"./miniprogram.aab60eab.js";const j={key:0,class:"login"},G=["href"],M=t("p",null,[w("\u6388\u6743\u5C0F\u7A0B\u5E8F\u4E4B\u524D\uFF0C\u8BF7\u5148\u524D\u5F80\u5FAE\u4FE1\u516C\u4F17\u53F7\u5E73\u53F0\u521B\u5EFA\u597D\u5C0F\u7A0B\u5E8F,"),t("a",{href:"https://mp.weixin.qq.com/",target:"_blank"},"\u300B\u300B\u5FAE\u4FE1\u516C\u4F17\u53F7\u5E73\u53F0")],-1),P={class:"expire"},R=["href"],T={class:"expire"},Y={class:"expire"},H={class:"expire"},I={class:"app-icon"},J=["src"],K={class:"expire"},L={class:"expire"},O=t("div",null,[t("p",null,"\u786E\u8BA4\u5DF2\u7ECF\u5B8C\u6210\u6388\u6743")],-1),ee=D({__name:"dashboard",setup(Q){const B=q(),i=V(),e=z({user_wp:{service_type_info:"",auth_date:"",nick_name:"",user_name:"",principal_name:"",head_img:"",authorizer_appid:""},modal:{auth:!1},weixin:{auth_code:"",expires_in:"",authorize:!1},auth:0}),p=_(()=>`${B.miniProgramUrl}/api/open/auth/redirect?auth_type=2&url=${b}/user/miniprogram/dashboard`),b=_(()=>window.location.protocol+"//"+window.location.host),C=_(()=>{if(e.user_wp.service_type_info){if(e.user_wp.service_type_info==="0")return"\u8BA2\u9605\u53F7";if(e.user_wp.service_type_info==="1")return"\u8001\u8BA2\u9605\u53F7";if(e.user_wp.service_type_info==="2")return"\u670D\u52A1\u53F7"}return""});S(()=>{i.query.auth_code&&(e.weixin.auth_code=i.query.auth_code.toString(),e.weixin.authorize=!0),i.query.expires_in&&(e.weixin.expires_in=i.query.expires_in.toString()),x()});const x=()=>{d(),e.weixin.authorize&&g()},d=()=>{U({}).then(a=>{a.data.item?(e.user_wp=a.data.item,e.auth=1):e.auth=-1,a.message&&m.success(a.message)})},g=()=>{$({auth_code:e.weixin.auth_code,expires_in:e.weixin.expires_in}).then(a=>{a.data.item?(e.user_wp=a.data.item,e.modal.auth=!0):m.success(a.message)})},h=()=>{e.modal.auth=!0},E=()=>{e.modal.auth=!1},y=()=>{e.modal.auth=!1,d()};return(a,W)=>{const n=r("h-form-item"),A=r("h-form"),k=r("h-modal"),v=r("h-card");return c(),f(v,{bordered:!1,title:"\u5C0F\u7A0B\u5E8F\u6388\u6743"},{default:u(()=>[e.auth<0?(c(),N("div",j,[t("p",null,[t("a",{class:"btn",target:"_blank",href:l(p),onClick:h},"\u6388\u6743\u5C0F\u7A0B\u5E8F",8,G)]),M])):F("",!0),e.auth>0?(c(),f(A,{key:1},{default:u(()=>[s(n,{label:"\u6388\u6743\u65F6\u95F4:",content:""},{default:u(()=>[t("span",P,o(e.user_wp.auth_date),1),t("p",null,[t("a",{class:"w-24 mb-2 mr-1 btn btn-primary",target:"_blank",href:l(p),onClick:h},"\u91CD\u65B0\u6388\u6743",8,R),w(" (\u5982\u8BEF\u5220\u5C0F\u7A0B\u5E8F\u6388\u6743\uFF0C\u8BF7\u91CD\u65B0\u6388\u6743) ")])]),_:1}),s(n,{label:"\u5C0F\u7A0B\u5E8F:",content:""},{default:u(()=>[t("span",T,o(e.user_wp.nick_name),1)]),_:1}),s(n,{label:"user_name:",content:""},{default:u(()=>[t("span",Y,o(e.user_wp.user_name),1)]),_:1}),s(n,{label:"appid:",content:""},{default:u(()=>[t("span",H,o(e.user_wp.authorizer_appid),1)]),_:1}),s(n,{label:"\u5934\u50CF:",content:""},{default:u(()=>[t("div",null,[t("div",I,[t("img",{src:e.user_wp.head_img},null,8,J)])])]),_:1}),s(n,{label:"\u5E10\u53F7\u7C7B\u578B:",content:""},{default:u(()=>[t("span",K,o(l(C)),1)]),_:1}),s(n,{label:"\u4E3B\u4F53:",content:""},{default:u(()=>[t("span",L,o(e.user_wp.principal_name),1)]),_:1})]),_:1})):F("",!0),s(k,{title:"\u6388\u6743",visible:e.modal.auth,onCancel:E},{footer:u(()=>[t("button",{class:"w-24 mb-2 mr-1 btn btn-primary",onClick:y},"\u5237\u65B0")]),default:u(()=>[O]),_:1},8,["visible"])]),_:1})}}});export{ee as default};
