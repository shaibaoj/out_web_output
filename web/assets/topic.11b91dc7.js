import{r as H,d as O,a7 as T,l as D,m as J,t as K,n as r,b as y,e as S,w as o,h as e,u as s,B as C,j as x,f as R,L as Q,s as M,q as G,k as Y,C as B,aC as ne,Y as N,F as P,c as j,g as A,y as X,M as se,G as Z,a8 as ee,a as $,ab as te}from"./index.b5f77459.js";import{p as q}from"./pick.c5d573cd.js";import{f as W}from"./goods.9f91d25e.js";const z={getItems:"/api/user/market/topic/list",getView:"/api/user/market/topic/view",updateItem:"/api/user/market/topic/update",getItemsGoods:"/api/user/market/topic/topic_items",updateGoods:"/api/user/market/topic/update_goods",updateStatus:"/api/user/market/topic/updateStatus"};function ie(E){return H({url:z.updateGoods,method:"post",data:E})}function ue(E){return H({url:z.updateItem,method:"post",data:E})}const re=O({__name:"topic",emits:["ok"],setup(E,{expose:V,emit:I}){const a=T().uploadUrl,c=D({id:0,classes:"",name:"",content:"",pic_url:""}),v={},t=D({visible:!1,confirmLoading:!1}),_=()=>{t.visible=!1},k=i=>{c.pic_url=i.data.item.img},g=J(v,K(c)),h=i=>{t.visible=!0,Object.assign(c,{id:0,classes:"",name:"",content:"",pic_url:""}),M(()=>{Object.assign(c,q(i,["id","name","content","pic_url"]))})},m=()=>{if(t.confirmLoading=!0,g.value.$touch(),g.value.$invalid)g.value.$errors,t.confirmLoading=!1;else{const i=s(c);ue(i).then(l=>{const{code:d}=l||{};d===0?G.success("\u4FDD\u5B58\u6210\u529F"):G.error(l.message),t.confirmLoading=!1,I("ok",i),t.visible=!1})}};return V({edit:h}),(i,l)=>{const d=r("FormInput"),b=r("h-form-item"),F=r("FormTextarea"),n=r("h-upload"),u=r("h-form"),p=r("LoadingIcon"),L=r("h-modal");return y(),S(L,{title:"\u53D1\u5E03\u4E13\u9898",size:"lg",visible:t.visible,"confirm-loading":t.confirmLoading,onCancel:_},{footer:o(()=>[e(s(C),{variant:"primary",class:"w-24 mb-2 mr-1",onClick:l[3]||(l[3]=f=>m())},{default:o(()=>[x(" \u4FDD\u5B58 "),t.confirmLoading?(y(),S(p,{key:0,icon:"oval",color:"white",class:"w-4 h-4 ml-2"})):R("v-if",!0)]),_:1})]),default:o(()=>[e(u,{layout:"small"},{default:o(()=>[e(b,{label:"\u4E13\u9898\u540D\u79F0",content:"",layout:"small"},{default:o(()=>[e(d,{type:"text",modelValue:c.name,"onUpdate:modelValue":l[0]||(l[0]=f=>c.name=f)},null,8,["modelValue"])]),_:1}),e(b,{label:"\u5185\u5BB9",content:"",layout:"small"},{default:o(()=>[e(F,{modelValue:c.content,"onUpdate:modelValue":l[1]||(l[1]=f=>c.content=f),rows:4},null,8,["modelValue"])]),_:1}),e(b,{label:"\u56FE\u7247",content:"",layout:"small"},{default:o(()=>[e(d,{type:"text",modelValue:c.pic_url,"onUpdate:modelValue":l[2]||(l[2]=f=>c.pic_url=f),placeholder:""},null,8,["modelValue"]),e(n,{name:"file",multiple:!0,action:s(a),onChange:k},{default:o(()=>[e(s(C),{variant:"outline-success",class:"w-32 mt-1 mb-2 mr-2 btn-sm"},{default:o(()=>[e(s(Q),{icon:"Upload",class:"w-4 h-4 mr-2"}),x("\u4E0A\u4F20 ")]),_:1})]),_:1},8,["action"])]),_:1})]),_:1})]),_:1},8,["visible","confirm-loading"])}}}),ce=Y(re,[["__file","/Users/wu./Documents/os/web/www/web/src/views/user/market/topic/modal/topic.vue"]]),me=["src"],de={key:1,class:"pics"},pe=A("p",null,"\u4E3B\u56FE\u53C2\u8003",-1),fe=["onClick"],_e=["src"],ge=O({__name:"goods",setup(E,{expose:V}){const U=T().uploadUrl,a=D({href:"",pic_url:"",id:0,item_id:"",title:"",price:0}),c={},v=D({topic_id:0}),t=D({visible:!1,confirmLoading:!1,data:{previewImg:"",pic_urls:[],wen_items:[]}}),_=()=>{t.visible=!1},k=n=>{a.pic_url=n.data.item.img},g=B(),h=J(c,K(a)),m=n=>{t.visible=!0,M(()=>{Object.assign(a,{href:"",pic_url:"",id:0,item_id:"",title:"",price:0}),v.topic_id=n.id,g.value.reload(!0)})},i=n=>{M(()=>{Object.assign(a,{href:"",pic_url:"",id:0,item_id:"",title:"",price:0});const u=q(n,["id","href","item_id","title","price","pic_url"]);Object.assign(a,u),t.data.pic_urls=[],b()})},l=()=>{if(t.confirmLoading=!0,h.value.$touch(),h.value.$invalid)h.value.$errors,t.confirmLoading=!1;else{const n=s(a);ie(Object.assign(n,{topic_id:v.topic_id})).then(u=>{const{code:p}=u||{};p===0?G.success("\u4FDD\u5B58\u6210\u529F"):G.error(u.message),t.confirmLoading=!1,g.value.reload(!0),i({})})}},d=()=>{W({href:a.href}).then(n=>{n.data.goods&&(M(()=>{Object.assign(a,q(n.data.goods,["href","item_id","title","price","pic_url"]))}),t.data.wen_items=n.data.goods.wen_items||[],t.data.pic_urls=n.data.goods.pic_urls||[]),t.confirmLoading=!1})},b=()=>{!a.href||W({content:a.href}).then(n=>{n.data.goods&&(t.data.pic_urls=n.data.goods.pic_urls||[])})},F=n=>{M(()=>{a.pic_url=n}),t.data.previewImg=n};return ne(()=>a.href,(n,u)=>{b()},{immediate:!0}),V({edit:m}),(n,u)=>{const p=r("h-form-item"),L=r("h-upload"),f=r("h-form"),oe=r("h-spin"),ae=r("h-modal");return y(),S(ae,{title:"\u4E13\u9898\u5546\u54C1\u7BA1\u7406",size:"xl",visible:t.visible,"confirm-loading":t.confirmLoading,onCancel:_},{footer:o(()=>[e(s(C),{variant:"primary",class:"w-24 mb-2 mr-1",onClick:u[4]||(u[4]=w=>l())},{default:o(()=>[x("\u4FDD\u5B58")]),_:1})]),default:o(()=>[e(oe,{spinning:t.confirmLoading},{default:o(()=>[e(f,{layout:"small"},{default:o(()=>[e(p,{label:"\u5730\u5740",content:"",layout:"small"},{default:o(()=>[e(s(N),null,{default:o(()=>[e(s(P),{type:"text",modelValue:a.href,"onUpdate:modelValue":u[0]||(u[0]=w=>a.href=w)},null,8,["modelValue"]),e(s(N).Text,null,{default:o(()=>[e(s(C),{class:"w-24",onClick:d},{default:o(()=>[x("\u83B7\u53D6")]),_:1})]),_:1})]),_:1})]),_:1}),e(p,{label:"\u6807\u9898",content:"",layout:"small"},{default:o(()=>[e(s(P),{type:"text",modelValue:a.title,"onUpdate:modelValue":u[1]||(u[1]=w=>a.title=w)},null,8,["modelValue"])]),_:1}),e(p,{label:"\u539F\u4EF7\u683C",content:"",layout:"small"},{default:o(()=>[e(s(P),{type:"text",modelValue:a.price,"onUpdate:modelValue":u[2]||(u[2]=w=>a.price=w)},null,8,["modelValue"])]),_:1}),e(p,{label:"\u56FE\u7247",content:"",layout:"small"},{default:o(()=>[e(s(P),{type:"text",modelValue:a.pic_url,"onUpdate:modelValue":u[3]||(u[3]=w=>a.pic_url=w),placeholder:""},null,8,["modelValue"]),e(L,{name:"file",multiple:!0,action:s(U),onChange:k},{default:o(()=>[e(s(C),{variant:"outline-success",class:"w-32 mt-1 mb-2 mr-2 btn-sm"},{default:o(()=>[e(s(Q),{icon:"Upload",class:"w-4 h-4 mr-2"}),x("\u4E0A\u4F20 ")]),_:1})]),_:1},8,["action"]),t.data.previewImg?(y(),j("img",{key:0,class:"previewImg",src:t.data.previewImg},null,8,me)):R("v-if",!0),t.data.pic_urls&&t.data.pic_urls.length>0?(y(),j("div",de,[pe,A("ul",null,[(y(!0),j(X,null,se(t.data.pic_urls,(w,le)=>(y(),j("li",{key:le,onClick:Ce=>F(w)},[A("img",{src:w},null,8,_e)],8,fe))),128))])])):R("v-if",!0)]),_:1})]),_:1})]),_:1},8,["spinning"])]),_:1},8,["visible","confirm-loading"])}}}),he=Y(ge,[["__file","/Users/wu./Documents/os/web/www/web/src/views/user/market/topic/modal/goods.vue"]]),we={class:"mt-2 xl:mt-0"},be=O({__name:"items",emits:["ok"],setup(E,{expose:V,emit:I}){const U=T(),a=Z(()=>`${U.urlPrefix}${U.apiUrl}${z.getItemsGoods}`),c=ee({}),v=[{formatter:"responsiveCollapse",width:40,minWidth:30,hozAlign:"center",resizable:!0,headerSort:!1},{title:"\u6807\u9898",field:"goods.title",formatter(l){return $(`<a target="_blank" href="${l.getData().item_url}">
          ${l.getData().goods.title}
        </a>`)[0]}},{title:"\u4EF7\u683C",field:"goods.price",width:100},{title:"\u56FE\u7247",field:"pic_url",width:100,formatter(l){return $(`<a target="_blank" href="${l.getData().item_url}">
          <img src="${l.getData().goods.pic_url}" />
        </a>`)[0]}},{title:"\u6240\u5C5E\u4E13\u9898",field:"topic.name",width:100}],t=D({rangePicker:"",name:"",status:0,startTime:"",endTime:"",topic_id:""}),_=D({visible:!1,confirmLoading:!1}),k=B(),g=B(),h=()=>{k.value.reload(!0)},m=()=>{_.visible=!1,I("ok",{})};return V({show:l=>{t.topic_id=l.topic_id,_.visible=!0,h()}}),(l,d)=>{const b=r("FormInput"),F=r("h-form-item"),n=r("Litepicker"),u=r("h-form"),p=te,L=r("h-drawer");return y(),j(X,null,[e(L,{title:"\u4E13\u4EAB\u4EA7\u54C1",size:"xl",visible:_.visible,"confirm-loading":_.confirmLoading,onCancel:m},{header:o(()=>[e(s(C),{variant:"primary",class:"mr-2 shadow-md",onClick:d[0]||(d[0]=f=>g.value.edit({}))},{default:o(()=>[x("\u53D1\u5E03 ")]),_:1})]),default:o(()=>[e(p,{ref_key:"tableRef",ref:k,columns:v,ajaxUrl:s(a),config:s(c),queryParam:t},{search:o(()=>[e(u,{layout:"inline"},{default:o(()=>[e(F,{label:"\u7528\u6237\u540D",content:"",layout:"inline"},{default:o(()=>[e(b,{type:"text",modelValue:t.name,"onUpdate:modelValue":d[1]||(d[1]=f=>t.name=f),class:"mt-2 sm:mt-0 sm:w-40 2xl:w-full"},null,8,["modelValue"])]),_:1}),e(F,{label:"\u521B\u5EFA\u65F6\u95F4",content:"",layout:"inline"},{default:o(()=>[e(n,{modelValue:t.rangePicker,"onUpdate:modelValue":d[2]||(d[2]=f=>t.rangePicker=f),options:{autoApply:!1,singleMode:!1,numberOfColumns:2,numberOfMonths:2,showWeekNumbers:!0,format:"YYYY-MM-DD",dropdowns:{minYear:1990,maxYear:null,months:!0,years:!0}},class:"mt-2 sm:mt-0 sm:w-56 2xl:w-full"},null,8,["modelValue"])]),_:1}),A("div",we,[e(s(C),{variant:"primary",type:"button",class:"w-full sm:w-16",onClick:h},{default:o(()=>[x(" \u67E5\u8BE2 ")]),_:1})])]),_:1})]),_:1},8,["ajaxUrl","config","queryParam"])]),_:1},8,["visible","confirm-loading"]),e(he,{ref_key:"goodsModal",ref:g,onOk:h},null,512)],64)}}}),ve=Y(be,[["__file","/Users/wu./Documents/os/web/www/web/src/views/user/market/topic/items.vue"]]),ke={class:"mt-2 xl:mt-0"},ye=O({__name:"topic",setup(E){const V=T(),I=Z(()=>`${V.urlPrefix}${V.apiUrl}${z.getItems}`),U=ee({}),a=[{formatter:"responsiveCollapse",width:40,minWidth:30,hozAlign:"center",resizable:!0,headerSort:!1},{title:"\u6807\u9898",field:"name",width:200},{title:"\u5185\u5BB9",field:"content"},{title:"\u56FE\u7247",field:"pic_url",width:100,formatter(m){return $(`<a target="_blank" href="${m.getData().item_url}">
          <img src="${m.getData().pic_url}" />
        </a>`)[0]}},{title:"\u5546\u54C1\u6570\u91CF",field:"count",width:100},{title:"\u5546\u54C1\u7BA1\u7406",hozAlign:"center",field:"",width:120,formatter(m){if(m.getData().status!=1&&m.getData().status!=2){const i=$('<a class="flex items-center text-center" href="javascript:;">\u7BA1\u7406</a>');return $(i).on("click",function(l){g({topic_id:m.getData().id})}),i[0]}return""}},{title:"\u64CD\u4F5C",hozAlign:"center",width:150,field:"",formatter(m){if(m.getData().status!=1&&m.getData().status!=2){const i=$('<a class="flex items-center" href="javascript:;">\u7F16\u8F91</a>');return $(i).on("click",function(l){h(m.getData())}),i[0]}return""}}],c=D({rangePicker:"",name:"",status:0,startTime:"",endTime:""}),v=B(),t=()=>{v.value.reload(!0)},_=B(),k=B(),g=m=>{k.value.show(m)},h=m=>{_.value.edit(m)};return(m,i)=>{const l=r("FormInput"),d=r("h-form-item"),b=r("Litepicker"),F=r("h-form"),n=te,u=r("h-card");return y(),S(u,{bordered:!1,title:"\u4E13\u9898"},{header:o(()=>[e(s(C),{variant:"primary",class:"mr-2 shadow-md",onClick:i[0]||(i[0]=p=>_.value.edit({}))},{default:o(()=>[x("\u53D1\u5E03\u4E13\u9898 ")]),_:1})]),default:o(()=>[e(n,{ref_key:"tableRef",ref:v,columns:a,ajaxUrl:s(I),config:s(U),queryParam:c},{search:o(()=>[e(F,{layout:"inline"},{default:o(()=>[e(d,{label:"\u7528\u6237\u540D",content:"",layout:"inline"},{default:o(()=>[e(l,{type:"text",modelValue:c.name,"onUpdate:modelValue":i[1]||(i[1]=p=>c.name=p),class:"mt-2 sm:mt-0 sm:w-40 2xl:w-full"},null,8,["modelValue"])]),_:1}),e(d,{label:"\u521B\u5EFA\u65F6\u95F4",content:"",layout:"inline"},{default:o(()=>[e(b,{modelValue:c.rangePicker,"onUpdate:modelValue":i[2]||(i[2]=p=>c.rangePicker=p),options:{autoApply:!1,singleMode:!1,numberOfColumns:2,numberOfMonths:2,showWeekNumbers:!0,format:"YYYY-MM-DD",dropdowns:{minYear:1990,maxYear:null,months:!0,years:!0}},class:"mt-2 sm:mt-0 sm:w-56 2xl:w-full"},null,8,["modelValue"])]),_:1}),A("div",ke,[e(s(C),{variant:"primary",type:"button",class:"w-full sm:w-16",onClick:t},{default:o(()=>[x(" \u67E5\u8BE2 ")]),_:1})])]),_:1})]),_:1},8,["ajaxUrl","config","queryParam"]),e(ce,{ref_key:"modal",ref:_,onOk:t},null,512),e(ve,{ref_key:"itemsModal",ref:k,onOk:t},null,512)]),_:1})}}}),De=Y(ye,[["__file","/Users/wu./Documents/os/web/www/web/src/views/user/market/topic.vue"]]);export{De as default};
